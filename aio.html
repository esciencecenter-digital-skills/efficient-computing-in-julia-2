<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Efficient Computing in Julia: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Efficient Computing in Julia
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Efficient Computing in Julia
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Efficient Computing in Julia
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="020-getting-started.html">1. Getting Started</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="030-julia-basics.html">2. Julia Syntax</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="040-dispatch-and-types.html">3. Types and Dispatch</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="050-arrays-and-broadcasting.html">4. Arrays and broadcasting</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="060-simulating-solar-system.html">5. Simulating the Solar System</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="070-pkg.html">6. Packages and environments</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="080-package-development.html">7. Package development</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="090-best-practices.html">8. Best practices</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="100-introduction-performance.html">9. Julia and performance</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="110-performance-analysis.html">10. Reducing allocations on the Logistic Map</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="120-dos-and-donts.html">11. Performance: do's and don'ts</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="130-channels-and-do.html">12. Channels and <code>do</code>-syntax</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="140-threads-async-and-tasks.html">13. Getting Started</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="145-distributed.html">14. Getting Started</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="150-transducers.html">15. Transducers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush17">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading17">
        <a href="160-cool-libraries.html">16. Recommended libraries</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush18">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading18">
        <a href="170-gpu-programming.html">17. (extra) GPU</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush19">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading19">
        <a href="a01-collatz.html">18. Appendix: Iterators and type stability</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush20">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading20">
        <a href="a02-julia-fractals.html">19. Appendix: Generating Julia Fractals</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush21">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading21">
        <a href="a03-lorenz-attractor.html">20. Appendix: Lorenz attractor</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-020-getting-started"><p>Content from <a href="020-getting-started.html">Getting Started</a></p>
<hr>
<p>Last updated on 2025-01-14 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/020-getting-started.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why should I use Julia?</li>
<li>How do I get started with Julia?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Start a REPL</li>
<li>Run lines from VS Code</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="why-julia">Why Julia<a class="anchor" aria-label="anchor" href="#why-julia"></a>
</h2>
<hr class="half-width">
<p>Most of the participants will be coming from Python, Matlab or a
lower level language like C/C++ or Fortran. Why should you be interested
in learning Julia?</p>
<div class="section level3">
<h3 id="performance-and-usability">Performance and usability<a class="anchor" aria-label="anchor" href="#performance-and-usability"></a>
</h3>
<p>Julia promises:</p>
<ul>
<li>Native performance: close to or sometimes even exceeding C++ or
Fortran.</li>
<li>Solve the multiple language issue: one language for everything
(including GPU).</li>
<li>As easy to get into as Python or R.</li>
<li>Designed for parallel computing.</li>
</ul>
<p>These promises seem tantalizing and are in part what draws people to
Julia, but in practice getting into Julia and writing performant code
are two different things. Julia has its own idiosyncrasies that need to
be understood to really squeeze every erg of performance out of your
system.</p>
<p>Julia obtains its performance from being a Just-In-Time (JIT)
compiler, on top of the lLVM compiler stack (similar to how Python’s
Numba operates).</p>
</div>
<div class="section level3">
<h3 id="language-intrinsics">Language intrinsics<a class="anchor" aria-label="anchor" href="#language-intrinsics"></a>
</h3>
<p>Next to being performant, it turns out that Julia is a very nice
language that does some things a bit different from what you may be used
to:</p>
<ul>
<li>
<strong>First-class arrays</strong> and
<strong>Broadcasting</strong>: arrays, slicing and operating on arrays
have dedicated syntax, similar to Matlab.</li>
<li>
<strong>Multiple dispatch</strong>: Julia functions can be
specialized on the entire call signature (not just its first argument
like in Object Oriented Programming).</li>
<li>
<strong>Macros and Meta-programming</strong>: The Just-in-time
nature of the Julia compiler exposes a wide range of meta-programming
capabilities, ranging from small macros to enhance the expressibility of
the language to full-on code generation.</li>
</ul>
<p>Meta-programming, while very powerful, is also very easy to abuse,
often leading to unreadable non-idiomatic code. So tread with care!
We’ll see some examples where macros are indispensable though, and the
SciML stack relies deeply on on-the-fly code-generation.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>Why are you interested in Julia? What is your current go-to for
efficient computing?</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="running-julia">Running Julia<a class="anchor" aria-label="anchor" href="#running-julia"></a>
</h2>
<hr class="half-width">
<p>When working in Julia it is very common to do so from the REPL
(Read-Eval-Print Loop). Please open the Julia REPL on your system</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$ julia
               _
   _       _ _(_)_     |  Documentation: https://docs.julialang.org
  (_)     | (_) (_)    |
   _ _   _| |_  __ _   |  Type "?" for help, "]?" for Pkg help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 1.10.3 (2024-04-30)
 _/ |\__'_|_|_|\__'_|  |  Official https://julialang.org/ release
|__/                   |

julia&gt;</code></pre>
</div>
<p>The REPL needs a small introduction since it has several
<strong>modes</strong>.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="26%">
<col width="42%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Key</th>
<th>Prompt</th>
<th>Mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>None</td>
<td><code>julia&gt;</code></td>
<td>Standard <strong>Julia</strong> input.</td>
</tr>
<tr class="even">
<td><code>]</code></td>
<td><code>pkg&gt;</code></td>
<td>
<strong>Pkg</strong> mode. Commands entered here are functions in
the <code>Pkg</code> module.</td>
</tr>
<tr class="odd">
<td><code>;</code></td>
<td><code>shell&gt;</code></td>
<td>
<strong>Shell</strong> mode.</td>
</tr>
<tr class="even">
<td><code>?</code></td>
<td><code>help?&gt;</code></td>
<td>
<strong>Help</strong> mode. Type the name of any entity to look up
its documentation.</td>
</tr>
</tbody>
</table>
<div id="play-with-the-repl-5min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="play-with-the-repl-5min" class="callout-inner">
<h3 class="callout-title">Play with the REPL (5min)</h3>
<div class="callout-content">
<ol style="list-style-type: lower-alpha">
<li>
<code>Pkg</code> mode has a <code>help</code> command to help you
along. Find out what the <code>add</code> command does.</li>
<li>Check the contents of the folder in which your are running your REPL
(<code>ls</code> on Unix, <code>dir</code> on Windows).</li>
<li>Find out what the <code>print</code> method does in Julia.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li>
<code>]help add</code>, the <code>add</code> command installs
packages</li>
<li><code>;ls</code></li>
<li><code>?print</code></li>
</ol>
</div>
</div>
</div>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Please take a look at the Julia documentation now at <a href="https://docs.julialang.org/en/v1/" class="external-link">https://docs.julialang.org/en/v1/</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="pluto">Pluto<a class="anchor" aria-label="anchor" href="#pluto"></a>
</h2>
<hr class="half-width">
<p>Pluto is the notebook environment from which we will teach much of
this workshop. We can run it from the Julia REPL.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>pkg&gt; add Pluto
... quite a bit of output ...

julia&gt; using Pluto

julia&gt; Pluto.run()
[ Info: Loading...
┌ Info:
└ Opening http://localhost:1235/?secret=xyzxyzxyz in your default browser... ~ have fun!
┌ Info:
│ Press Ctrl+C in this terminal to stop Pluto
└</code></pre>
</div>
</section><section><h2 class="section-heading" id="vs-code">VS Code<a class="anchor" aria-label="anchor" href="#vs-code"></a>
</h2>
<hr class="half-width">
<p>VS Code is the editor for which Julia has the best support. We’ll be
needing to run Julia in multiple threads later on, so we’ll set some
arguments for the REPL in <code>settings.json</code> (press
<code>Ctrl-,</code>).</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JSON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode json" tabindex="0"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="er">...</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="dt">"julia.additionalArgs"</span><span class="fu">:</span> <span class="ot">[</span> </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        <span class="st">"-t"</span><span class="ot">,</span> <span class="st">"4"</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">}</span></span></code></pre>
</div>
<p>Now when you start a new REPL, (<code>Ctrl-Shift-P</code>, search
“Julia REPL”) you can query the number of threads available:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="bu">Threads</span>.<span class="fu">nthreads</span>()</span></code></pre>
</div>
<div id="julia-as-a-calculator-5min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="julia-as-a-calculator-5min" class="callout-inner">
<h3 class="callout-title">Julia as a calculator (5min)</h3>
<div class="callout-content">
<p>Try to play around in Pluto to use Julia as a calculator.</p>
<ol style="list-style-type: lower-alpha">
<li>What do you find is the operator for exponentiation?</li>
<li>How do you assign a variable?</li>
<li>What happens when you divide any two integers? Use the
<code>typeof</code> function to inspect the type of the result. Can you
figure out how to integer division (search the documentation!)?</li>
<li>What happens in Pluto when you change a variable that is depended
upon?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li>In Julia exponentiation is <code>^</code>.</li>
<li>Just like you’re used to <code>x = 3</code>.</li>
<li>The <code>/</code> operator always returns a floating point value.
To get to integer division, we want the <code>÷</code> operator, which
can be typed using <code>\div</code> and then press TAB. Or you can use
the equivalent <code>div</code> function.</li>
<li>Pluto updates all dependent computations automatically. This is
known as a <strong>reactive notebook</strong>.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>In Julia, the REPL is much more important than in some other
languages.</li>
<li>Pluto is a reactive environment</li>
<li>VS Code has the best editor integration for Julia</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="activate-the-workshop-environment">Activate the Workshop Environment<a class="anchor" aria-label="anchor" href="#activate-the-workshop-environment"></a>
</h2>
<hr class="half-width">
<p>For this workshop, we prepared an environment. Press <code>]</code>
in the REPL to activate <code>Pkg</code> mode. Make sure that you are in
the path where you prepared your environment (see Setup
Instructions).</p>
<pre><code>(v1.11) pkg&gt; activate .
(EfficientJulia) pkg&gt;</code></pre>
<p>Alternatively, check the little “Julia env” message at the bottom of
VS Code, and make sure that the correct environment is there.</p>
<p>You should now be able to generate a plot using <code>GLMakie</code>
(that one dependency that made you wait)</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>x <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span><span class="op">:</span><span class="fl">0.1</span><span class="op">:</span><span class="fl">3.0</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>z <span class="op">=</span> <span class="fu">sinc</span>.(<span class="fu">sqrt</span>.(x<span class="op">.^</span><span class="fl">2</span> <span class="op">.+</span> x<span class="op">'.^</span><span class="fl">2</span>))</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="fu">surface</span>(x, x, z, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">wireframe!</span>(x, x, z, color<span class="op">=:</span>black, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre>
</div>
<figure><img src="fig/getting-started-makie.png" alt="A 3d rendering of a sinc function." class="figure mx-auto d-block"><div class="figcaption">A 3D surface plot</div>
</figure><div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Figure code </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>To create the above figure:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">#| classes: ["task"]</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#| creates: episodes/fig/getting-started-makie.png</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#| collect: figures</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="kw">module</span> Script</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="kw">function</span> <span class="fu">main</span>()</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    x <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span><span class="op">:</span><span class="fl">0.1</span><span class="op">:</span><span class="fl">3.0</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    z <span class="op">=</span> <span class="fu">sinc</span>.(<span class="fu">sqrt</span>.(x<span class="op">.^</span><span class="fl">2</span> <span class="op">.+</span> x<span class="op">'.^</span><span class="fl">2</span>))</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1024</span>, <span class="fl">768</span>))</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>])</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    <span class="fu">surface!</span>(ax, x, x, z, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    <span class="fu">wireframe!</span>(ax, x, x, z, color<span class="op">=:</span>black, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    <span class="fu">save</span>(<span class="st">"episodes/fig/getting-started-makie.png"</span>, fig)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>Script.<span class="fu">main</span>()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-030-julia-basics"><p>Content from <a href="030-julia-basics.html">Julia Syntax</a></p>
<hr>
<p>Last updated on 2025-01-13 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/030-julia-basics.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I write elementary programs in Julia?</li>
<li>What are the differences with Python/Matlab/R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>functions</li>
<li>loops</li>
<li>conditionals</li>
<li>containers: arrays, dictionary, set</li>
<li>primitive types</li>
<li>strings (inc interpolation)</li>
<li>scoping (and do syntax?)</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Unfortunately, it lies outside the scope of this workshop to give a
introduction to the full Julia language. Instead, we’ll briefly show the
basic syntax, and then focus on some key differences with other popular
languages.</p>
<section><h2 class="section-heading" id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h2>
<hr class="half-width">
<p>Functions are declared with the <code>function</code> keyword. The
<strong>block</strong> or function <strong>body</strong> is ended with
<code>end</code>. All blocks in Julia end with <code>end</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">const</span> G <span class="op">=</span> <span class="fl">6.6743e-11</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gravitational_force</span>(m1, m2, r)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="cf">return</span> G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">/</span> r<span class="op">^</span><span class="fl">2</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>Let’s compute the force between Earth and Moon, given the following
constants:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">const</span> EARTH_MASS <span class="op">=</span> <span class="fl">5.97219e24</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># const EARTH_RADIUS = 6.378e6</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="kw">const</span> LUNAR_MASS <span class="op">=</span> <span class="fl">7.34767e22</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="kw">const</span> LUNAR_DISTANCE <span class="op">=</span> <span class="fl">384_400_000.0</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">gravitational_force</span>(EARTH_MASS, LUNAR_MASS, LUNAR_DISTANCE)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1.982084770423259e26</span></span></code></pre>
</div>
<p>There is a shorter syntax for functions that is useful for
one-liners:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">gravitational_force</span>(m1, m2, r) <span class="op">=</span> G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">/</span> r<span class="op">^</span><span class="fl">2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="anonymous-functions-or-lambdas">Anonymous functions (or lambdas)<a class="anchor" aria-label="anchor" href="#anonymous-functions-or-lambdas"></a>
</h3>
<p>Julia inherits a lot of concepts from functional programming. There
are two ways to define anonymous functions:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>F_g <span class="op">=</span> <span class="kw">function</span>(m1, m2, r)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="cf">return</span> G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">/</span> r<span class="op">^</span><span class="fl">2</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>And a shorter syntax,</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>F_g <span class="op">=</span> (m1, m2, r) <span class="op">-&gt;</span> G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">/</span> r<span class="op">^</span><span class="fl">2</span></span></code></pre>
</div>
<div id="higher-order-functions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="higher-order-functions" class="callout-inner">
<h3 class="callout-title">Higher order functions</h3>
<div class="callout-content">
<p>Use the <code>map</code> function in combination with an anonymous
function to compute the squares of the first ten integers (use
<code>1:10</code> to create that range).</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Read the documentation of <code>map</code> using the <code>?</code>
help mode, also available in Pluto.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">map</span>(x <span class="op">-&gt;</span> x<span class="op">^</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>)</span></code></pre>
</div>
<p>In fact, we’ll see that <code>map</code> is not often used, since
Julia has many better ways to express mapping operations of this
kind.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="if-statements-for-loops">If statements, for loops<a class="anchor" aria-label="anchor" href="#if-statements-for-loops"></a>
</h2>
<hr class="half-width">
<p>Here’s another function that’s a little more involved.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">is_prime</span>(x)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="cf">if</span> x <span class="op">&lt;</span> <span class="fl">2</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="cf">for</span> i <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fu">isqrt</span>(x)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">%</span> i <span class="op">==</span> <span class="fl">0</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>      <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="cf">return</span> <span class="cn">true</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div id="ranges" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ranges" class="callout-inner">
<h3 class="callout-title">Ranges</h3>
<div class="callout-content">
<p>The <code>for</code> loop iterates over the range
<code>2:isqrt(x)</code>. We’ll see that Julia indexes sequences starting
at integer value <code>1</code>. This usually implies that ranges are
given inclusive on both ends: for example, <code>collect(3:6)</code>
evaluates to <code>[3, 4, 5, 6]</code>.</p>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>The <code>i == j &amp;&amp; continue</code> is a short-cut notation
for</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="cf">if</span> i <span class="op">==</span> j</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>	<span class="cf">continue</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="cf">end</span></span></code></pre>
</div>
<p>We could also have written <code>i != j || continue</code>.</p>
<p>In general, the <code>||</code> and <code>&amp;&amp;</code> operators
can be chained to check increasingly stringent tests. For example:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">inbounds</span>(<span class="dt">Bool</span>, i, data) <span class="op">&amp;&amp;</span> data[i] <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="fl">3</span><span class="op">*</span>data[i]</span></code></pre>
</div>
<p>Here, the second condition can only be evaluated if the first one was
true.</p>
<p><strong>Rewrite the <code>is_prime</code> function using this
notation.</strong></p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">is_prime</span>(x)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    x <span class="op">&lt;</span> <span class="fl">2</span> <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fu">isqrt</span>(x)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>        x <span class="op">%</span> i <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">true</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="fu">is_prime</span>(<span class="fl">42</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="fu">is_prime</span>(<span class="fl">43</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="return-statement" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="return-statement" class="callout-inner">
<h3 class="callout-title">Return statement</h3>
<div class="callout-content">
<p>In Julia, the <code>return</code> statement is not always strictly
necessary. Every statement is an expression, meaning that it has a
value. The value of a compound block is simply that of its last
expression. In the above function however, we have a non-local return:
once we find a divider for a number, we know the number is not prime,
and we don’t need to check any further.</p>
<p>Many people find it more readable however, to always have an explicit
<code>return</code>.</p>
</div>
</div>
</div>
<div id="more-on-for-loops" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="more-on-for-loops" class="callout-inner">
<h3 class="callout-title">More on for-loops</h3>
<div class="callout-content">
<p>Loop iterations can be skipped using <code>continue</code>, or broken
with <code>break</code>, identical to C or Python.</p>
</div>
</div>
</div>
<div id="lexical-scoping" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="lexical-scoping" class="callout-inner">
<h3 class="callout-title">Lexical scoping</h3>
<div class="callout-content">
<p>Julia is <strong>lexically scoped</strong>. This means that variables
do not outlive the block that they’re defined in. In a nutshell, this
means the following:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">let</span> s <span class="op">=</span> <span class="fl">42</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">println</span>(s)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="cf">for</span> s <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    <span class="fu">println</span>(s)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="fu">println</span>(s)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">42</span></span>
<span><span class="fl">1</span></span>
<span><span class="fl">2</span></span>
<span><span class="fl">3</span></span>
<span><span class="fl">42</span></span></code></pre>
</div>
<p>In effect, the variable <code>s</code> inside the for-loop is said to
<strong>shadow</strong> the outer definition. Here, we also see a first
example of a <code>let</code> binding, creating a scope for some
temporary variables to live in.</p>
</div>
</div>
</div>
<div id="loops-and-conditionals" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="loops-and-conditionals" class="callout-inner">
<h3 class="callout-title">Loops and conditionals</h3>
<div class="callout-content">
<p>Write a loop that prints out all primes below 100.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="cf">if</span> <span class="fu">is_prime</span>(i)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="fu">println</span>(i)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="cf">end</span></span></code></pre>
</div>
<p>If you like to collect those into a vector, try the following:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fl">1</span><span class="op">:</span><span class="fl">100</span> <span class="op">|&gt;</span> <span class="fu">filter</span>(is_prime) <span class="op">|&gt;</span> collect</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="some-important-first-lessons">Some important first lessons<a class="anchor" aria-label="anchor" href="#some-important-first-lessons"></a>
</h2>
<hr class="half-width">
<ul>
<li>Always enclose code in functions because functions are compiled</li>
<li>Don’t use global mutable variables</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Julia has <code>if-else</code>, <code>for</code>,
<code>while</code>, <code>function</code> and <code>module</code> blocks
that are not dissimilar from other languages.</li>
<li>Blocks are all ended with <code>end</code>.</li>
<li>…</li>
<li>Julia variables are not visible outside the block in which they’re
defined (unlike Python).</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-040-dispatch-and-types"><p>Content from <a href="040-dispatch-and-types.html">Types and Dispatch</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/040-dispatch-and-types.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How does Julia deal with types?</li>
<li>Can I do Object Oriented Programming?</li>
<li>People keep talking about multiple dispatch. What makes it so
special?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>dispatch</li>
<li>structs</li>
<li>abstract types</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Julia is a dynamically typed language. Nevertheless, we will see that
knowing where and where not to annotate types in your program is crucial
for managing performance.</p>
<p>In Julia there are two reasons for using the type system:</p>
<ul>
<li>structuring your data by declaring a <code>struct</code>
</li>
<li>dispatching methods based on their argument types</li>
</ul>
<section><h2 class="section-heading" id="inspection">Inspection<a class="anchor" aria-label="anchor" href="#inspection"></a>
</h2>
<hr class="half-width">
<p>You may inspect the dynamic type of a variable or expression using
the <code>typeof</code> function. For instance:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fl">3</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">Int64</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="st">"hello"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">String</span></span></code></pre>
</div>
<div id="plenary-types-of-floats" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="plenary-types-of-floats" class="callout-inner">
<h3 class="callout-title">(plenary) Types of floats</h3>
<div class="callout-content">
<p>Check the type of the following values:</p>
<ol style="list-style-type: lower-alpha">
<li><code>3</code></li>
<li><code>3.14</code></li>
<li><code>6.62607015e-34</code></li>
<li><code>6.6743f-11</code></li>
<li><code>6e0 * 7f0</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li><code>Int64</code></li>
<li><code>Float64</code></li>
<li><code>Float64</code></li>
<li><code>Float32</code></li>
<li><code>Float64</code></li>
</ol>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="structures">Structures<a class="anchor" aria-label="anchor" href="#structures"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">struct</span> Point2</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  x<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  y<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">let</span> p <span class="op">=</span> <span class="fu">Point2</span>(<span class="fl">1</span>, <span class="fl">3</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">println</span>(<span class="st">"Point at </span><span class="sc">$</span><span class="st">{</span>p<span class="st">.x}, </span><span class="sc">$</span><span class="st">{</span>p<span class="st">.y}"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h3>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">dot</span>(a<span class="op">::</span><span class="dt">Point2</span>, b<span class="op">::</span><span class="dt">Point2</span>) <span class="op">=</span> a.x<span class="op">*</span>b.x <span class="op">+</span> a.y<span class="op">*</span>b.y</span></code></pre>
</div>
<div id="d-point" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="d-point" class="callout-inner">
<h3 class="callout-title">3d Point</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">struct</span> Point3</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  x<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  y<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  z<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">dot</span>(a<span class="op">::</span><span class="dt">Point3</span>, b<span class="op">::</span><span class="dt">Point3</span>) <span class="op">=</span> a.x<span class="op">*</span>b.x <span class="op">+</span> a.y<span class="op">*</span>b.y <span class="op">+</span> a.z<span class="op">*</span>b.z</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="multiple-dispatch-function-overloading">Multiple dispatch (function overloading)<a class="anchor" aria-label="anchor" href="#multiple-dispatch-function-overloading"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">Point2</span>, b<span class="op">::</span><span class="dt">Point2</span>) <span class="op">=</span> <span class="fu">Point2</span>(a.x<span class="op">+</span>b.x, a.y<span class="op">+</span>b.y)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">Point2</span>(<span class="fl">1</span>, <span class="fl">2</span>) <span class="op">+</span> <span class="fu">Point2</span>(<span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fu">Point2</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div id="oop-sort-of" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="oop-sort-of" class="callout-inner">
<h3 class="callout-title">OOP (Sort of)</h3>
<div class="callout-content">
<p>Julia is not an Object Oriented language. If you feel the unstoppable
urge to implement a class-like abstraction, this can be done through
abstract types.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">abstract type</span> Vehicle <span class="kw">end</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="kw">struct</span> Car <span class="op">&lt;:</span><span class="dt"> Vehicle</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="kw">struct</span> Bike <span class="op">&lt;:</span><span class="dt"> Vehicle</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="kw">function</span> <span class="fu">travel_time</span>(v<span class="op">::</span><span class="dt">Vehicle</span>, distance<span class="op">::</span><span class="dt">Float64</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fuel_cost</span>(v<span class="op">::</span><span class="dt">Vehicle</span>, <span class="op">::</span><span class="dt">Float64</span>)</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fuel_cost</span>(v<span class="op">::</span><span class="dt">Car</span>, distance<span class="op">::</span><span class="dt">Float64</span>)</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Julia is fundamentally a dynamically typed language.</li>
<li>Static types are only ever used for dispatch.</li>
<li>Multiple dispatch is the most important means of abstraction in
Julia.</li>
<li>Parametric types are important to achieve type stability.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-050-arrays-and-broadcasting"><p>Content from <a href="050-arrays-and-broadcasting.html">Arrays and broadcasting</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/050-arrays-and-broadcasting.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Does Julia have something similar to NumPy?</li>
<li>How do I deal with arrays without writing for-loops everywhere?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Apply dot-notation broadcasting</li>
<li>Understand array type notation</li>
<li>Array indexing and manipulation (push, append)</li>
<li>1d and 2d concatenation (vcat, hcat, stack)</li>
<li>Basic linear algebra: matrix multiply and solving
<code>\</code>.</li>
<li>Helper functions to generate vectors and matrices: zeros, ones,
rand</li>
<li>LinearAlgebra package and main functions: dot, norm</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Julia has column-major array lay-out, which may be confusing when
you come from a row-major language like NumPy.</li>
<li>Use <code>.</code> notation to do point-wise computations on
arrays.</li>
<li>Linear algebra is fully supported in the standard library.</li>
</ul>
</div>
</div>
</div></section><section id="aio-060-simulating-solar-system"><p>Content from <a href="060-simulating-solar-system.html">Simulating the Solar System</a></p>
<hr>
<p>Last updated on 2025-01-14 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/060-simulating-solar-system.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I work with physical units?</li>
<li>How do I quickly visualize some data?</li>
<li>How is dispatch used in practice?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn to work with <code>Unitful</code>
</li>
<li>Take the first steps with <code>Makie</code> for visualisation</li>
<li>Work with <code>const</code>
</li>
<li>Define a <code>struct</code>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In this episode we’ll be building a simulation of the solar system.
That is, we’ll only consider the Sun, Earth and Moon, but feel free to
add other planets to the mix later on! To do this we need to work with
the laws of gravity. We will be going on extreme tangents, exposing
interesting bits of the Julia language as we go.</p>
<section><h2 class="section-heading" id="introduction-to-unitful">Introduction to <code>Unitful</code>
<a class="anchor" aria-label="anchor" href="#introduction-to-unitful"></a>
</h2>
<hr class="half-width">
<p>We’ll be using the <code>Unitful</code> library to ensure that we
don’t mix up physical units.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span></code></pre>
</div>
<p>Using <code>Unitful</code> is without any run-time overhead. The unit
information is completely contained in the <code>Quantity</code> type.
With <code>Unitful</code> we can attach units to quantities using the
<code>@u_str</code> syntax:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fl">1.0</span>u<span class="st">"kg"</span> <span class="op">==</span> <span class="fl">1000.0</span>u<span class="st">"g"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fl">2.0</span>u<span class="st">"m"</span> <span class="op">-</span> <span class="fl">8.0</span>u<span class="st">"cm"</span></span></code></pre>
</div>
<div id="try-adding-incompatible-quantities" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="try-adding-incompatible-quantities" class="callout-inner">
<h3 class="callout-title">Try adding incompatible quantities</h3>
<div class="callout-content">
<p>For instance, add a quantity in meters to one in seconds. Be
creative. Can you understand the error messages?</p>
</div>
</div>
</div>
<p>Next to that, we use the <code>Vec3d</code> type from
<code>GeometryBasics</code> to store vector particle positions.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeometryBasics</span></span></code></pre>
</div>
<p>Libraries in Julia tend to work well together, even if they’re not
principally designed to do so. We can combine <code>Vec3d</code> with
<code>Unitful</code> with no problems.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">Vec3d</span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>)u<span class="st">"km"</span></span></code></pre>
</div>
<div id="generate-random-vec3d" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="generate-random-vec3d" class="callout-inner">
<h3 class="callout-title">Generate random Vec3d</h3>
<div class="callout-content">
<p>The <code>Vec3d</code> type is a static 3-vector of double precision
floating point values. Read the documentation on the <a href="https://docs.julialang.org/en/v1/stdlib/Random/#Base.randn" class="external-link"><code>randn</code>
function</a>. Can you figure out a way to generate a random
<code>Vec3d</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>One way is to generate three random numbers and convert the resulting
array to a <code>Vec3d</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">Vec3d</span>(<span class="fu">randn</span>(<span class="dt">Float64</span>, <span class="fl">3</span>))</span></code></pre>
</div>
<p>But it is even better to call <code>randn</code> with the
<code>Vec3d</code> argument directly:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">randn</span>(Vec3d)</span></code></pre>
</div>
<p>(We can time these using <code>@btime</code> from
<code>BenchmarkTools</code>)</p>
</div>
</div>
</div>
</div>
<p>Two bodies of mass <span class="math inline">\(M\)</span> and <span class="math inline">\(m\)</span> attract each other with the force</p>
<p><span class="math display">\[F = \frac{GMm}{r^2},\]</span></p>
<p>where <span class="math inline">\(r\)</span> is the distance between
those bodies, and <span class="math inline">\(G\)</span> is the
universal gravitational constant.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="kw">const</span> G <span class="op">=</span> <span class="fl">6.6743e-11</span>u<span class="st">"m^3*kg^-1*s^-2"</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">gravitational_force</span>(m1, m2, r) <span class="op">=</span> G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">/</span> r<span class="op">^</span><span class="fl">2</span></span></code></pre>
</div>
<p>Verify that the force exerted between two 1 million kg bodies at a
distance of 2.5 meters is about equal to holding a 1kg object on Earth.
Or equivalently two one tonne objects at a distance of 2.5 mm (all of
the one tonne needs to be concentrated in a space tiny enough to get two
of them at that close a distance)</p>
<p>A better way to write the force would be,</p>
<p><span class="math display">\[\vec{F} = \hat{r} \frac{G M
m}{|r|^2},\]</span></p>
<p>where <span class="math inline">\(\hat{r} = \vec{r} / |r|\)</span>,
so in total we get a third power, <span class="math inline">\(|r|^3 =
(r^2)^{3/2}\)</span>, where <span class="math inline">\(r^2\)</span> can
be computed with the dot-product.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">gravitational_force</span>(m1, m2, r<span class="op">::</span><span class="dt">AbstractVector</span>) <span class="op">=</span> r <span class="op">*</span> (G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">*</span> (r <span class="op">⋅</span> r)<span class="op">^</span>(<span class="op">-</span><span class="fl">1.5</span>))</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">gravitational_force</span>(<span class="fl">1e3</span>u<span class="st">"kg"</span>, <span class="fl">1e3</span>u<span class="st">"kg"</span>, <span class="fu">Vec3d</span>(<span class="fl">2.5</span>, <span class="fl">0</span>, <span class="fl">0</span>)u<span class="st">"mm"</span>) <span class="op">.|&gt;</span> u<span class="st">"N"</span></span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Not all of you will be jumping up and down for doing high-school
physics. We will get to other sciences than physics later in this
workshop, I promise!</p>
</div>
</div>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The <code>⋅</code> operator (enter using
<code>\cdot&lt;TAB&gt;</code>) performs the
<code>LinearAlgebra.dot</code> function. We could have done
<code>sum(r * r)</code>. However, the <code>sum</code> function works on
iterators and has a generic implementation. We could define our own
<code>dot</code> function:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dot</span>(a<span class="op">::</span><span class="dt">AbstractVector{T}</span>, b<span class="op">::</span><span class="dt">AbstractVector{T}</span>) <span class="kw">where</span> {T}</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    Prod <span class="op">=</span> <span class="fu">typeof</span>(<span class="fu">zero</span>(T) <span class="op">*</span> <span class="fu">zero</span>(T))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>	x <span class="op">=</span> <span class="fu">zero</span>(Prod)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>	<span class="pp">@simd</span> ivdep <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(a)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>		x <span class="op">+=</span> a[i] <span class="op">*</span> b[i]</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>	<span class="cf">return</span> x</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>If we look for the source</p>
<pre><code>@which LinearAlgebra.dot(a, b)</code></pre>
<p>We find that we’re actually running the dot product from the
<code>StaticArrays</code> library, which has a very similar
implementation as ours.</p>
</div>
</div>
</div>
<div id="the-zero-function" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-zero-function" class="callout-inner">
<h3 class="callout-title">The <code>zero</code> function</h3>
<div class="callout-content">
<p>The <code>zero</code> function is overloaded to return a zero object
for any type that has a natural definition of zero.</p>
</div>
</div>
</div>
<div id="the-one-function" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="the-one-function" class="callout-inner">
<h3 class="callout-title">The <code>one</code> function</h3>
<div class="callout-content">
<p>The return-value of <code>zero</code> should be the additive identity
of the given type. So for any type <code>T</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">let</span> T <span class="op">=</span> <span class="dt">Int</span>, x <span class="op">=</span> <span class="fu">rand</span>(T); x <span class="op">==</span> x <span class="op">+</span> <span class="fu">zero</span>(T) <span class="kw">end</span></span></code></pre>
</div>
<p>There also is the <code>one</code> function which returns the
multiplicative identity of a given type. Try to use the <code>*</code>
operator on two strings. What do you expect <code>one(String)</code> to
return?</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="particles">Particles<a class="anchor" aria-label="anchor" href="#particles"></a>
</h2>
<hr class="half-width">
<p>We are now ready to define the <code>Particle</code> type.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span>: Mass, Length, Velocity</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="kw">mutable struct</span> Particle</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    mass<span class="op">::</span><span class="dt">typeof</span>(<span class="fl">1.0</span>u<span class="st">"kg"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    position<span class="op">::</span><span class="dt">typeof</span>(<span class="fu">Vec3d</span>(<span class="fl">1</span>)u<span class="st">"m"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    momentum<span class="op">::</span><span class="dt">typeof</span>(<span class="fu">Vec3d</span>(<span class="fl">1</span>)u<span class="st">"kg*m/s"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="fu">Particle</span>(mass<span class="op">::</span><span class="dt">Mass</span>, position<span class="op">::</span><span class="dt">Vec3{L}</span>, velocity<span class="op">::</span><span class="dt">Vec3{V}</span>) <span class="kw">where</span> {L<span class="op">&lt;:</span><span class="dt">Length</span>,V<span class="op">&lt;:</span><span class="dt">Velocity</span>} <span class="op">=</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    <span class="fu">Particle</span>(mass, position, velocity <span class="op">*</span> mass)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="fu">velocity</span>(p<span class="op">::</span><span class="dt">Particle</span>) <span class="op">=</span> p.momentum <span class="op">/</span> p.mass</span></code></pre>
</div>
<p>We store the momentum of the particle, so that what follows is
slightly simplified.</p>
<p>It is custom to divide the computation of orbits into a <em>kick</em>
and <em>drift</em> function. (There are deep mathematical reasons for
this that we won’t get into.) We’ll first implement the
<code>kick!</code> function, that updates a collection of particles,
given a certain time step.</p>
</section><section><h2 class="section-heading" id="the-kick">The kick<a class="anchor" aria-label="anchor" href="#the-kick"></a>
</h2>
<hr class="half-width">
<p>The following function performs the <code>kick!</code> operation on a
set of particles. We’ll go on a little tangent for every line in the
function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">kick!</span>(particles, dt)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(particles)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>(i<span class="op">-</span><span class="fl">1</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>            r <span class="op">=</span> particles[j].position <span class="op">-</span> particles[i].position</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>            force <span class="op">=</span> <span class="fu">gravitational_force</span>(particles[i].mass, particles[j].mass, r)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>            particles[i].momentum <span class="op">+=</span> dt <span class="op">*</span> force</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>            particles[j].momentum <span class="op">-=</span> dt <span class="op">*</span> force</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>    <span class="cf">return</span> particles</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div id="why-the-exclamation-mark" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-the-exclamation-mark" class="callout-inner">
<h3 class="callout-title">Why the <code>!</code> exclamation mark?</h3>
<div class="callout-content">
<p>In Julia it is custom to have an exclamation mark at the end of names
of functions that mutate their arguments.</p>
</div>
</div>
</div>
<div id="use-eachindex" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="use-eachindex" class="callout-inner">
<h3 class="callout-title">Use <code>eachindex</code>
</h3>
<div class="callout-content">
<p>Note the way we used <code>eachindex</code>. This idiom guarantees
that we can’t make out-of-bounds errors. Also this kind of indexing is
generic over other collections than vectors. However, this is
immediately destroyed by our next loop.</p>
</div>
</div>
</div>
<div id="broadcasting-vs.-specialization" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="broadcasting-vs.-specialization" class="callout-inner">
<h3 class="callout-title">Broadcasting vs. specialization</h3>
<div class="callout-content">
<p>We’re subtracting two vectors. We could have written that with
dot-notation indicating a broadcasted function application. Generate two
random numbers:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>a, b <span class="op">=</span> <span class="fu">randn</span>(Vec3d, <span class="fl">2</span>)</span></code></pre>
</div>
<p>Then time the subtraction broadcasted and non-broadcasted. Which is
faster? Why?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="pp">@btime</span> a <span class="op">-</span> b</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="pp">@btime</span> a <span class="op">.-</span> b</span></code></pre>
</div>
<p>Broadcasting is slower. It seems to do some needless allocation.
Clearly, the authors of <code>GeometryBasics</code> have taken effort to
optimize basic vector operations.</p>
</div>
</div>
</div>
</div>
<div id="callout6" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>We’re iterating over the range <code>1:(i-1)</code>, and so we don’t
compute forces twice. Momentum should be conserved!</p>
</div>
</div>
</div>
<p>Luckily the <code>drift!</code> function is much easier to implement,
and doesn’t require that we know about all particles.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">drift!</span>(p<span class="op">::</span><span class="dt">Particle</span>, dt)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    p.position <span class="op">+=</span> dt <span class="op">*</span> p.momentum <span class="op">/</span> p.mass</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="kw">function</span> <span class="fu">drift!</span>(particles, dt)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>        <span class="fu">drift!</span>(p, dt)</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>    <span class="cf">return</span> particles</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>Note that we defined the <code>drift!</code> function twice, for
different arguments. We’re using the dispatch mechanism to write
clean/readable code.</p>
<div class="section level3">
<h3 id="fixing-arguments">Fixing arguments<a class="anchor" aria-label="anchor" href="#fixing-arguments"></a>
</h3>
<p>One pattern that you can find repeatedly in the standard library is
that of <em>fixing</em> arguments of functions to make them more
composable. For instance, most comparison operators allow you to give a
single argument, saving the second argument for a second invocation.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">filter</span>(x <span class="op">-&gt;</span> x <span class="op">&lt;</span> <span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">&lt;</span>(<span class="fl">3</span>), <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)</span></code></pre>
</div>
<p>and even</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">map</span>(<span class="fu">filter</span>(<span class="fu">&lt;</span>(<span class="fl">5</span>)), <span class="fu">eachcol</span>(<span class="fu">rand</span>(<span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">5</span>)))</span></code></pre>
</div>
<p>We can do a similar thing here:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">kick!</span>(dt) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">Fix2</span>(kick!, dt)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">drift!</span>(dt) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">Fix2</span>(drift!, dt)</span></code></pre>
</div>
<p>These kinds of identities let us be flexible in how to use and
combine methods in different circumstances.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">leap_frog!</span>(dt) <span class="op">=</span> <span class="fu">drift!</span>(dt) <span class="op">∘</span> <span class="fu">kick!</span>(dt)</span></code></pre>
</div>
<p>This defines the <code>leap_frog!</code> function as first performing
a <code>kick!</code> and then a <code>drift!</code>. Another way to
compose these functions is the <code>|&gt;</code> operator. In contrast
to the <code>∘</code> operator, <code>|&gt;</code> is very popular and
seen everywhere in Julia code bases.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">leap_frog!</span>(particles, dt) <span class="op">=</span> particles <span class="op">|&gt;</span> <span class="fu">kick!</span>(dt) <span class="op">|&gt;</span> <span class="fu">drift!</span>(dt)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">leap_frog!</span>(dt) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">Fix2</span>(leap_frog!, dt)</span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="with-random-particles">With random particles<a class="anchor" aria-label="anchor" href="#with-random-particles"></a>
</h2>
<hr class="half-width">
<p>Let’s run a simulation with some random particles</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">run_simulation</span>(particles, dt, n)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    result <span class="op">=</span> <span class="fu">Matrix</span><span class="dt">{typeof(Vec3d(1)u"m")}</span>(<span class="cn">undef</span>, n, <span class="fu">length</span>(particles))</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">deepcopy</span>(particles)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fu">eachrow</span>(result)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>        x <span class="op">=</span> <span class="fu">leap_frog!</span>(dt)(x)</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>        c[<span class="op">:</span>] <span class="op">=</span> [p.position for p <span class="kw">in</span> <span class="fu">values</span>(x)]</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>    <span class="fu">DataFrame</span>(<span class="op">:</span>time <span class="op">=&gt;</span> (<span class="fl">1</span><span class="op">:</span>n)dt, (<span class="fu">Symbol</span>.(<span class="st">"p"</span>, <span class="fu">keys</span>(particles)) <span class="op">.=&gt;</span> <span class="fu">eachcol</span>(result))<span class="op">...</span>)</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="frame-of-reference">Frame of reference<a class="anchor" aria-label="anchor" href="#frame-of-reference"></a>
</h3>
<p>We need to make sure that our entire system doesn’t have a net
velocity. Otherwise it will be hard to visualize our results!</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">set_still!</span>(particles)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    total_momentum <span class="op">=</span> <span class="fu">sum</span>(p.momentum <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles))</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    total_mass <span class="op">=</span> <span class="fu">sum</span>(p.mass <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles))</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>    correction <span class="op">=</span> total_momentum <span class="op">/</span> total_mass</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles)</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>        p.momentum <span class="op">-=</span> correction <span class="op">*</span> p.mass</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>    <span class="cf">return</span> particles</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="cf">end</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h3>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_orbits</span>(orbits<span class="op">::</span><span class="dt">DataFrame</span>)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], limits<span class="op">=</span>((<span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>), (<span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>), (<span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>)))</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>    <span class="cf">for</span> colname <span class="kw">in</span> <span class="fu">names</span>(orbits)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>        <span class="fu">scatter!</span>(ax, [orbits[<span class="fl">1</span>, colname] <span class="op">/</span> u<span class="st">"m"</span>])</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, orbits[!, colname] <span class="op">/</span> u<span class="st">"m"</span>)</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>    fig</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>Try a few times with two random particles. You may want to use the
<code>set_still!</code> function to negate any collective motion.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">random_orbits</span>(n, mass)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>    <span class="fu">random_particle</span>() <span class="op">=</span> <span class="fu">Particle</span>(mass, <span class="fu">randn</span>(Vec3d)u<span class="st">"m"</span>, <span class="fu">randn</span>(Vec3d)u<span class="st">"mm/s"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>    particles <span class="op">=</span> <span class="fu">set_still!</span>([<span class="fu">random_particle</span>() for _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n])</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    <span class="fu">run_simulation</span>(particles, <span class="fl">1.0</span>u<span class="st">"s"</span>, <span class="fl">5000</span>)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">random_orbits</span>(<span class="fl">3</span>, <span class="fl">1e6</span>u<span class="st">"kg"</span>) <span class="op">|&gt;</span> plot_orbits</span></code></pre>
</div>
<figure><img src="fig/random-orbits.png" alt="the three-body problem" class="figure mx-auto d-block"><div class="figcaption">Possible random orbits for two and three
particles.</div>
</figure>
</div>
</section><section><h2 class="section-heading" id="solar-system">Solar System<a class="anchor" aria-label="anchor" href="#solar-system"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="kw">const</span> SUN <span class="op">=</span> <span class="fu">Particle</span>(<span class="fl">2e30</span>u<span class="st">"kg"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">0.0</span>)u<span class="st">"m"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">0.0</span>)u<span class="st">"m/s"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="kw">const</span> EARTH <span class="op">=</span> <span class="fu">Particle</span>(<span class="fl">6e24</span>u<span class="st">"kg"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">1.5e11</span>, <span class="fl">0</span>, <span class="fl">0</span>)u<span class="st">"m"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">0</span>, <span class="fl">3e4</span>, <span class="fl">0</span>)u<span class="st">"m/s"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="kw">const</span> MOON <span class="op">=</span> <span class="fu">Particle</span>(<span class="fl">7.35e22</span>u<span class="st">"kg"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>    EARTH.position <span class="op">+</span> <span class="fu">Vec3d</span>(<span class="fl">3.844e8</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>)u<span class="st">"m"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>    <span class="fu">velocity</span>(EARTH) <span class="op">+</span> <span class="fu">Vec3d</span>(<span class="fl">0</span>, <span class="fl">1e3</span>, <span class="fl">0</span>)u<span class="st">"m/s"</span>)</span></code></pre>
</div>
<div id="challenge" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Plot the orbit of the moon around the earth. Make a
<code>Dataframe</code> that contains all model data, and work from
there. Can you figure out the period of the orbit?</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<code>Plots.jl</code> is in some ways the ‘standard’ plotting
package, but it is in fact quite horrible.</li>
<li>
<code>Makie.jl</code> offers a nice interface, pretty plots, is
generally stable and very efficient once things have been compiled.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Testing and Plots </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co">#| file: src/Gravity.jl</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="kw">module</span> Gravity</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeometryBasics</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="op">&lt;&lt;</span>gravity<span class="op">&gt;&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co">#| classes: ["task"]</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co">#| creates: episodes/fig/random-orbits.png</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="co">#| collect: figures</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="kw">module</span> Script</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="im">using</span> <span class="bu">EfficientJulia.Gravity</span>: random_orbits</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_orbits!</span>(ax, orbits<span class="op">::</span><span class="dt">DataFrame</span>)</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>    <span class="cf">for</span> colname <span class="kw">in</span> <span class="fu">names</span>(orbits)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>        <span class="fu">scatter!</span>(ax, [orbits[<span class="fl">1</span>,colname] <span class="op">/</span> u<span class="st">"m"</span>])</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, orbits[!,colname] <span class="op">/</span> u<span class="st">"m"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="kw">function</span> <span class="fu">main</span>()</span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>    <span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">0</span>)</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a>    orbs1 <span class="op">=</span> <span class="fu">random_orbits</span>(<span class="fl">2</span>, <span class="fl">1e6</span>u<span class="st">"kg"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>    <span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">15</span>)</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a>    orbs2 <span class="op">=</span> <span class="fu">random_orbits</span>(<span class="fl">3</span>, <span class="fl">1e6</span>u<span class="st">"kg"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1024</span>, <span class="fl">600</span>))</span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>], azimuth<span class="op">=</span><span class="cn">π</span><span class="op">/</span><span class="fl">2</span><span class="op">+</span><span class="fl">0.1</span>, elevation<span class="op">=</span><span class="fl">0.1</span>π, title<span class="op">=</span><span class="st">"two particles"</span>)</span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>,<span class="fl">2</span>], azimuth<span class="op">=</span><span class="cn">π</span><span class="op">/</span><span class="fl">3</span>, title<span class="op">=</span><span class="st">"three particles"</span>)</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>    <span class="fu">plot_orbits!</span>(ax1, orbs1)</span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a>    <span class="fu">plot_orbits!</span>(ax2, orbs2)</span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a>    <span class="fu">save</span>(<span class="st">"episodes/fig/random-orbits.png"</span>, fig)</span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a>    fig</span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a>Script.<span class="fu">main</span>()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-070-pkg"><p>Content from <a href="070-pkg.html">Packages and environments</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/070-pkg.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I work with environments?</li>
<li>What are these <code>Project.toml</code> and
<code>Manifest.toml</code> files?</li>
<li>How do I install more dependencies?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>pkg&gt; status</li>
<li>pkg&gt; add (in more details)</li>
<li>pkg&gt; remove</li>
<li>Project.toml</li>
<li>Manifest.toml</li>
<li>pkg&gt; instantiate</li>
<li>pkg&gt; activate</li>
<li>pkg&gt; activate –temp</li>
<li>pkg&gt; activate <span class="citation">@place</span>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Julia has a built-in package manager called <code>Pkg</code>.</li>
<li>The package manager is usually accessed from the REPL, by pressing
<code>]</code>.</li>
<li>
<code>Project.toml</code> lists the dependencies of a package.</li>
<li>
<code>Manifest.toml</code> specifies a completely reproducible
environment with exact versions.</li>
</ul>
</div>
</div>
</div></section><section id="aio-080-package-development"><p>Content from <a href="080-package-development.html">Package development</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/080-package-development.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is the best workflow for developing a Julia package?</li>
<li>How can I prevent having to recompile every time I make a
change?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Quick start with pkg&gt; generate</li>
<li>Basic structure of a package</li>
<li>VSCode</li>
<li>Revise.jl</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Currently, the editor with (by far) the best support is VSCode.</li>
<li>The <code>Revise.jl</code> module can automatically reload parts of
your code that have changed.</li>
<li>Best practice: file names should reflect module names.</li>
</ul>
</div>
</div>
</div></section><section id="aio-090-best-practices"><p>Content from <a href="090-best-practices.html">Best practices</a></p>
<hr>
<p>Last updated on 2025-01-13 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/090-best-practices.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I setup unit testing?</li>
<li>What about documentation?</li>
<li>Are there good Github Actions available for CI/CD?</li>
<li>I like autoformatters for my code, what is the best one for
Julia?</li>
<li>How can I make all this a bit easier?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>tests</li>
<li>documentation</li>
<li>GitHub workflows</li>
<li>JuliaFormatter.jl</li>
<li>BestieTemplate.jl</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The following is a function for computing the roots of a cubic
polynomial</p>
<p><span class="math display">\[ax^3 + bx^2 + cx + d = 0.\]</span></p>
<p>There is an interesting story about these equations. It was known for
a long time how to solve quadratic equations. In 1535 the Italian
mathematician Tartaglia discovered a way to solve cubic equations, but
guarded his secret carefully. He was later persuaded by Cardano to
reveal his secret on the condition that Cardano wouldn’t reveal it
further. However, later Cardano found out that an earlier mathematician
Scipione del Ferro had also cracked the problem and decided that this
anulled his deal with Tartaglia, and published anyway. These days, the
formula is known as Cardano’s formula.</p>
<p>The interesting bit is that this method requires the use of complex
numbers.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">cubic_roots</span>(a, b, c, d)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>	cNaN <span class="op">=</span> <span class="cn">NaN</span><span class="op">+</span><span class="cn">NaN</span><span class="op">*</span><span class="cn">im</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>	</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>	<span class="cf">if</span> (a <span class="op">!=</span> <span class="fl">0</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>		delta0 <span class="op">=</span> b<span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span>a<span class="op">*</span>c</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>		delta1 <span class="op">=</span> <span class="fl">2</span><span class="op">*</span>b<span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">9</span><span class="op">*</span>a<span class="op">*</span>b<span class="op">*</span>c <span class="op">+</span> <span class="fl">27</span><span class="op">*</span>a<span class="op">^</span><span class="fl">2</span><span class="op">*</span>d</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>		cc <span class="op">=</span> ((delta1 <span class="op">+</span> <span class="fu">sqrt</span>(delta1<span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">4</span><span class="op">*</span>delta0<span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">0im</span>)) <span class="op">/</span> <span class="fl">2</span>)<span class="op">^</span>(<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>		zeta <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1im</span><span class="op">/</span><span class="fl">2</span> <span class="op">*</span> <span class="fu">sqrt</span>(<span class="fl">3</span>)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>		k <span class="op">=</span> (<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>		<span class="cf">return</span> (<span class="op">-</span><span class="fl">1</span><span class="op">/</span>(<span class="fl">3</span><span class="op">*</span>a)) <span class="op">.*</span> (b <span class="op">.+</span> zeta<span class="op">.^</span>k <span class="op">.*</span> cc <span class="op">.+</span> delta0 <span class="op">./</span> (zeta<span class="op">.^</span>k <span class="op">.*</span> cc))</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>	<span class="cf">if</span> (b <span class="op">!=</span> <span class="fl">0</span>)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>		delta <span class="op">=</span> <span class="fu">sqrt</span>(c<span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> b <span class="op">*</span> d <span class="op">+</span> <span class="fl">0im</span>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>		<span class="cf">return</span> ((<span class="op">-</span>c <span class="op">-</span> delta) <span class="op">/</span> (<span class="fl">2</span><span class="op">*</span>b), (<span class="op">-</span>c <span class="op">+</span> delta) <span class="op">/</span> (<span class="fl">2</span><span class="op">*</span>b), cNaN)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>	<span class="cf">if</span> (c <span class="op">!=</span> <span class="fl">0</span>)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>		<span class="cf">return</span> (<span class="op">-</span>d<span class="op">/</span>c <span class="op">+</span> <span class="fl">0.0im</span>, cNaN, cNaN)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>	<span class="cf">if</span> (d <span class="op">!=</span> <span class="fl">0</span>)</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>		<span class="cf">return</span> (cNaN, cNaN, cNaN)</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>	<span class="cf">return</span> (<span class="fl">0.0</span><span class="op">+</span><span class="fl">0.0im</span>, cNaN, cNaN)</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Julia has integrated support for unit testing.</li>
<li>
<code>Documenter.jl</code> is the standard package for generating
documentation.</li>
<li>The Julia ecosystem is well equiped to help you keep your code in
fit shape.</li>
</ul>
</div>
</div>
</div></section><section id="aio-100-introduction-performance"><p>Content from <a href="100-introduction-performance.html">Julia and performance</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/100-introduction-performance.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can Julia be so much faster than Python?</li>
<li>I can’t say Julia is slow, but why is it so sluggish?</li>
<li>How can I reason about performance?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the strategy of JIT compilation.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The Julia compiler compiles a function once its called with a
specific type signature.</li>
</ul>
</div>
</div>
</div></section><section id="aio-110-performance-analysis"><p>Content from <a href="110-performance-analysis.html">Reducing allocations on the Logistic Map</a></p>
<hr>
<p>Last updated on 2025-01-13 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/110-performance-analysis.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I reduce the number of allocations?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Apply a code transformation to write to pre-allocated memory.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Logistic growth (in economy or biology) is sometimes modelled using
the recurrence formula:</p>
<p><span class="math display">\[N_{i+1} = r N_{i} (1 -
N_{i}),\]</span></p>
<p>also known as the <strong>logistic map</strong>, where <span class="math inline">\(r\)</span> is the <strong>reproduction
factor</strong>. For low values of <span class="math inline">\(N\)</span> this behaves as exponential growth.
However, most growth processes will hit a ceiling at some point. Let’s
try:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">logistic_map</span>(r) <span class="op">=</span> n <span class="op">-&gt;</span> r <span class="op">*</span> n <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> n)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">IterTools</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">using</span> <span class="bu">.Iterators</span>: take, flatten</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">take</span>(<span class="fu">iterated</span>(<span class="fu">logistic_map</span>(<span class="fl">3.0</span>), <span class="fl">0.001</span>), <span class="fl">200</span>) <span class="op">|&gt;</span> collect <span class="op">|&gt;</span> lines</span></code></pre>
</div>
<div id="vary-r" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="vary-r" class="callout-inner">
<h3 class="callout-title">Vary <code>r</code>
</h3>
<div class="callout-content">
<p>Try different values of <span class="math inline">\(r\)</span>, what
do you see?</p>
<p>Extra (advanced!): see the <a href="https://docs.makie.org/stable/reference/blocks/slider" class="external-link">Makie
documention on <code>Slider</code></a>. Can you make an interactive
plot?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    sl_r <span class="op">=</span> <span class="fu">Slider</span>(fig[<span class="fl">2</span>, <span class="fl">2</span>], range<span class="op">=</span><span class="fl">1.0</span><span class="op">:</span><span class="fl">0.001</span><span class="op">:</span><span class="fl">4.0</span>, startvalue<span class="op">=</span><span class="fl">2.0</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="fu">Label</span>(fig[<span class="fl">2</span>,<span class="fl">1</span>], <span class="fu">lift</span>(r<span class="op">-&gt;</span><span class="st">"r = </span><span class="sc">$</span>r<span class="st">"</span>, sl_r.value))</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    points <span class="op">=</span> <span class="fu">lift</span>(sl_r.value) <span class="cf">do</span> r</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>        <span class="fu">take</span>(<span class="fu">iterated</span>(<span class="fu">logistic_map</span>(r), <span class="fl">0.001</span>), <span class="fl">50</span>) <span class="op">|&gt;</span> collect</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], limits<span class="op">=</span>(<span class="cn">nothing</span>, (<span class="fl">0.0</span>, <span class="fl">1.0</span>)))</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="fu">plot!</span>(ax, points)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, points)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    fig</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>There seem to be key values of <span class="math inline">\(r\)</span>
where the iteration of the logistic map splits into periodic orbits, and
even get into chaotic behaviour.</p>
<p>We can plot all points for an arbitrary sized orbit for all values of
<span class="math inline">\(r\)</span> between 2.6 and 4.0. First of
all, let’s see how the <code>iterated |&gt; take |&gt; collect</code>
function chain performs.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">take</span>(<span class="fu">iterated</span>(<span class="fu">logistic_map</span>(<span class="fl">3.5</span>), <span class="fl">0.5</span>), <span class="fl">10000</span>) <span class="op">|&gt;</span> collect</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">iterated_fn</span>(f, x, n)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    result <span class="op">=</span> <span class="dt">Float64</span>[]</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>        x <span class="op">=</span> <span class="fu">f</span>(x)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>        <span class="fu">push!</span>(result, x)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">iterated_fn</span>(<span class="fu">logistic_map</span>(<span class="fl">3.5</span>), <span class="fl">0.5</span>, <span class="fl">10000</span>)</span></code></pre>
</div>
<p>That seems to be slower than the original! Let’s try to improve:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">iterated_fn</span>(f, x, n)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    result <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, n)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        x <span class="op">=</span> <span class="fu">f</span>(x)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>        result[i] <span class="op">=</span> x</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">iterated_fn</span>(<span class="fu">logistic_map</span>(<span class="fl">3.5</span>), <span class="fl">0.5</span>, <span class="fl">10000</span>)</span></code></pre>
</div>
<p>We can do better if we don’t need to allocate:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">iterated_fn!</span>(f, x, out)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(out)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>        x <span class="op">=</span> <span class="fu">f</span>(x)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>        out[i] <span class="op">=</span> x</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>out <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, <span class="fl">10000</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">iterated_fn!</span>(<span class="fu">logistic_map</span>(<span class="fl">3.5</span>), <span class="fl">0.5</span>, out)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">logistic_map_points</span>(r<span class="op">::</span><span class="dt">Real</span>, n_skip)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="fu">make_point</span>(x) <span class="op">=</span> <span class="fu">Point2f</span>(r, x)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    x0 <span class="op">=</span> <span class="fu">nth</span>(<span class="fu">iterated</span>(<span class="fu">logistic_map</span>(r), <span class="fl">0.5</span>), n_skip)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="bu">Iterators</span>.<span class="fu">map</span>(make_point, <span class="fu">iterated</span>(<span class="fu">logistic_map</span>(r), x0))</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">takestrict</span>(<span class="fu">logistic_map_points</span>(<span class="fl">3.5</span>, <span class="fl">1000</span>), <span class="fl">1000</span>) <span class="op">|&gt;</span> collect</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">logistic_map_points</span>(rs<span class="op">::</span><span class="dt">AbstractVector{R}</span>, n_skip, n_take) <span class="kw">where</span> {R <span class="op">&lt;:</span><span class="dt"> Real</span>}</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="bu">Iterators</span>.<span class="fu">flatten</span>(<span class="bu">Iterators</span>.<span class="fu">take</span>(<span class="fu">logistic_map_points</span>(r, n_skip), n_take) <span class="cf">for</span> r <span class="kw">in</span> rs) </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">logistic_map_points</span>(<span class="fu">LinRange</span>(<span class="fl">2.6</span>, <span class="fl">4.0</span>, <span class="fl">1000</span>), <span class="fl">1000</span>, <span class="fl">1000</span>) <span class="op">|&gt;</span> collect</span></code></pre>
</div>
<p>First of all, let’s visualize the output because its so pretty!</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    pts <span class="op">=</span> <span class="fu">logistic_map_points_td</span>(<span class="fu">LinRange</span>(<span class="fl">2.6</span>, <span class="fl">4.0</span>, <span class="fl">10000</span>), <span class="fl">1000</span>, <span class="fl">10000</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>	fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">700</span>))</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>	ax <span class="op">=</span> Makie.<span class="fu">Axis</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>], limits<span class="op">=</span>((<span class="fl">2.6</span>, <span class="fl">4.0</span>), <span class="cn">nothing</span>))</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>	<span class="fu">datashader!</span>(ax, pts, async<span class="op">=</span><span class="cn">false</span>, colormap<span class="op">=:</span>deep)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>	fig</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="pp">@profview</span> <span class="fu">logistic_map_points</span>(<span class="fu">LinRange</span>(<span class="fl">2.6</span>, <span class="fl">4.0</span>, <span class="fl">1000</span>), <span class="fl">1000</span>, <span class="fl">1000</span>) <span class="op">|&gt;</span> collect</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">collect!</span>(it, tgt)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    <span class="cf">for</span> (i, v) <span class="kw">in</span> <span class="fu">zip</span>(<span class="fu">eachindex</span>(tgt), it)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>        tgt[i] <span class="op">=</span> <span class="fu">v_map</span>(r) <span class="op">=</span> n <span class="op">-&gt;</span> r </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="kw">function</span> <span class="fu">logistic_map_points_td</span>(rs<span class="op">::</span><span class="dt">AbstractVector{R}</span>, n_skip, n_take) <span class="kw">where</span> {R <span class="op">&lt;:</span><span class="dt"> Real</span>}</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    result <span class="op">=</span> <span class="fu">Matrix</span><span class="dt">{Point2}</span>(<span class="cn">undef</span>, n_take, <span class="fu">length</span>(rs))</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    <span class="co"># Threads.@threads for i in eachindex(rs)</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(rs)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>        <span class="fu">collect!</span>(<span class="fu">logistic_map_points</span>(rs[i], n_skip), <span class="fu">view</span>(result, <span class="op">:</span>, i))</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">reshape</span>(result, <span class="op">:</span>)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">logistic_map_points_td</span>(<span class="fu">LinRange</span>(<span class="fl">2.6</span>, <span class="fl">4.0</span>, <span class="fl">1000</span>), <span class="fl">1000</span>, <span class="fl">1000</span>)</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="pp">@profview</span> <span class="fu">logistic_map_points_td</span>(<span class="fu">LinRange</span>(<span class="fl">2.6</span>, <span class="fl">4.0</span>, <span class="fl">10000</span>), <span class="fl">1000</span>, <span class="fl">1000</span>)</span></code></pre>
</div>
<div id="rewrite-the-logistic_map_points-function" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="rewrite-the-logistic_map_points-function" class="callout-inner">
<h3 class="callout-title">Rewrite the <code>logistic_map_points</code>
function</h3>
<div class="callout-content">
<p>Rewrite the last function, so that everything is in one body (Fortran
style!). Is this faster than using iterators?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">logistic_map_points_raw</span>(rs<span class="op">::</span><span class="dt">AbstractVector{R}</span>, n_skip, n_take, out<span class="op">::</span><span class="dt">AbstractVector{P}</span>) <span class="kw">where</span> {R <span class="op">&lt;:</span><span class="dt"> Real</span>, P}</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    <span class="co"># result = Array{Float32}(undef, 2, n_take, length(rs))</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="co"># result = Array{Point2f}(undef, n_take, length(rs))</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    <span class="pp">@assert</span> <span class="fu">length</span>(out) <span class="op">==</span> <span class="fu">length</span>(rs) <span class="op">*</span> n_take</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    <span class="co"># result = reshape(reinterpret(Float32, out), 2, n_take, length(rs))</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    result <span class="op">=</span> <span class="fu">reshape</span>(out, n_take, <span class="fu">length</span>(rs))</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(rs)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>        x <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>        r <span class="op">=</span> rs[i]</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_skip</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>            x <span class="op">=</span> r <span class="op">*</span> x <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> x)</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_take</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>            x <span class="op">=</span> r <span class="op">*</span> x <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> x)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>            result[j, i] <span class="op">=</span> <span class="fu">P</span>(r, x)</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>            <span class="co">#result[1, j, i] = r</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>            <span class="co">#result[2, j, i] = x</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>        <span class="co"># result[1, :, i] .= r</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>    <span class="co"># return reshape(reinterpret(Point2f, result), :)</span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>    <span class="co"># return reshape(result, :)</span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>    out</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>out <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Point2d}</span>(<span class="cn">undef</span>, <span class="fl">1000000</span>)</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a><span class="fu">logistic_map_points_raw</span>(<span class="fu">LinRange</span>(<span class="fl">2.6</span>, <span class="fl">4.0</span>, <span class="fl">1000</span>), <span class="fl">1000</span>, <span class="fl">1000</span>, out)</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">logistic_map_points_raw</span>(<span class="fu">LinRange</span>(<span class="fl">2.6</span>, <span class="fl">4.0</span>, <span class="fl">1000</span>), <span class="fl">1000</span>, <span class="fl">1000</span>, out)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Allocations are slow.</li>
<li>Growing arrays dynamically induces allocations.</li>
</ul>
</div>
</div>
</div></section><section id="aio-120-dos-and-donts"><p>Content from <a href="120-dos-and-donts.html">Performance: do's and don'ts</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/120-dos-and-donts.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Can you give me some guiding principles on how to keep Julia code
performant?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Identify potential problems with given code.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="type-stability">Type Stability<a class="anchor" aria-label="anchor" href="#type-stability"></a>
</h2>
<hr class="half-width">
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>A good summary on type stability can be found in the following blog
post: - <a href="https://www.juliabloggers.com/writing-type-stable-julia-code/" class="external-link">Writing
type-stable Julia code</a></p>
</div>
</div>
</div>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Don’t use mutable global variables.</li>
<li>Write your code inside functions.</li>
<li>Specify element types for containers and structs.</li>
<li>Specialize functions instead of doing manual dispatch.</li>
<li>Write functions that always return the same type (type
stability).</li>
<li>Don’t change the type of variables.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-130-channels-and-do"><p>Content from <a href="130-channels-and-do.html">Channels and do-syntax</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/130-channels-and-do.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we manage streams with internal state?</li>
<li>Does Julia have context managers, or other ways to manage
resources?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Work with <code>Channel</code>s to create streams.</li>
<li>Understand <code>do</code> syntax.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Channels are Julia’s primary means of state management and
inter-thread communication.</li>
</ul>
</div>
</div>
</div></section><section id="aio-140-threads-async-and-tasks"><p>Content from <a href="140-threads-async-and-tasks.html">Getting Started</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/140-threads-async-and-tasks.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we distribute work across threads?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Change for-loops to run parallel.</li>
<li>Launch tasks and generate results asynchronously.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Basic parallel for-loops are done with the <code>@threads</code>
macro.</li>
<li>Julia has built-in support for atomics.</li>
<li>Channels are primary means of asynchronous communication.</li>
</ul>
</div>
</div>
</div></section><section id="aio-145-distributed"><p>Content from <a href="145-distributed.html">Getting Started</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/145-distributed.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Does Julia have support for MPI?</li>
<li>Can I scale my tasks to multiple machines?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to run Julia on HPC.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Julia has built-in support for distributed computing.</li>
</ul>
</div>
</div>
</div></section><section id="aio-150-transducers"><p>Content from <a href="150-transducers.html">Transducers</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/150-transducers.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Aren’t there better abstractions to deal with parallelism, like
<code>map</code> and <code>reduce</code>?</li>
<li>What other libraries exist to aid in parallel computing, and what
makes them special?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Exposure to some higher level programming concepts.</li>
<li>Learn how to work with the pipe <code>|&gt;</code> operator.</li>
<li>Write performant code that scales.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>List of libraries:</p>
<ul>
<li><code>Transducers.jl</code></li>
<li><code>Folds.jl</code></li>
<li><code>FLoops.jl</code></li>
</ul>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Transducers are composable functions.</li>
<li>Using the <code>|&gt;</code> operator can make your code consise,
with fewer parenthesis, and more readable.</li>
<li>Overusing the <code>|&gt;</code> operator can make your code an
absolute mess.</li>
<li>Using Tranducers you can build scalable data pipe lines.</li>
<li>Many Julia libraries for parallel computing and data processing are
built on top of Tranducers.</li>
</ul>
</div>
</div>
</div></section><section id="aio-160-cool-libraries"><p>Content from <a href="160-cool-libraries.html">Recommended libraries</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/160-cool-libraries.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Is there a recommended set of standard libraries?</li>
<li>What is the equivalent of SciPy in Julia.</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Get street-wise.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This is a nice closing episode.</p>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>SciML toolkit is dominant but not always the best choice.</li>
<li>Search for libraries that specify your needs.</li>
</ul>
</div>
</div>
</div></section><section id="aio-170-gpu-programming"><p>Content from <a href="170-gpu-programming.html">(extra) GPU</a></p>
<hr>
<p>Last updated on 2025-01-13 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/170-gpu-programming.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Can I have some Cuda please?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>See what the current state of GPU computing over Julia is.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="state-of-things">State of things<a class="anchor" aria-label="anchor" href="#state-of-things"></a>
</h2>
<hr class="half-width">
<p>There are separate packages for GPU computing, depending on the
hardware you have.</p>
<table class="table">
<thead><tr class="header">
<th>Brand</th>
<th>Lib</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>NVidia</td>
<td><a href="https://github.com/JuliaGPU/CUDA.jl" class="external-link"><code>CUDA.jl</code></a></td>
</tr>
<tr class="even">
<td>AMD</td>
<td><a href="https://github.com/JuliaGPU/AMDGPU.jl" class="external-link"><code>AMDGPU.jl</code></a></td>
</tr>
<tr class="odd">
<td>Intel</td>
<td><a href="https://github.com/JuliaGPU/oneAPI.jl" class="external-link"><code>oneAPI.jl</code></a></td>
</tr>
<tr class="even">
<td>Apple</td>
<td><a href="https://github.com/JuliaGPU/Metal.jl" class="external-link"><code>Metal.jl</code></a></td>
</tr>
</tbody>
</table>
<p>Each of these offer similar abstractions for dealing with array based
computations, though each with slightly different names. CUDA by far has
the best and most mature support. We can get reasonably portable code by
using the above packages in conjunction with
<code>KernelAbstractions</code>.</p>
</section><section><h2 class="section-heading" id="kernelabstractions">
<code>KernelAbstractions</code><a class="anchor" aria-label="anchor" href="#kernelabstractions"></a>
</h2>
<hr class="half-width">
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-Intel" name="Intel" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Intel" type="button" role="tab" aria-controls="nav-tabpanel-1-Intel" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-Intel">
  Intel
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Metal" name="Metal" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Metal" type="button" role="tab" aria-controls="nav-tabpanel-1-Metal" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Metal">
  Metal
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-NVidia" name="NVidia" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-NVidia" type="button" role="tab" aria-controls="nav-tabpanel-1-NVidia" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-NVidia">
  NVidia
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-AMD" name="AMD" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-AMD" type="button" role="tab" aria-controls="nav-tabpanel-1-AMD" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-AMD">
  AMD
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-Intel" class="tab-pane show active" aria-labelledby="nav-tab-1-Intel" role="tabpanel">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">oneAPI</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">using</span> <span class="bu">KernelAbstractions</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-Metal" class="tab-pane" aria-labelledby="nav-tab-1-Metal" role="tabpanel">
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">Metal</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">KernelAbstractions</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-NVidia" class="tab-pane" aria-labelledby="nav-tab-1-NVidia" role="tabpanel">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">CUDA</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">KernelAbstractions</span></span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-AMD" class="tab-pane" aria-labelledby="nav-tab-1-AMD" role="tabpanel">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">AMDGPU</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">KernelAbstractions</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="pp">@kernel</span> <span class="kw">function</span> <span class="fu">vector_add</span>(a, b, c)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    I <span class="op">=</span> <span class="pp">@index</span>(Global)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    c[I] <span class="op">=</span> a[I] <span class="op">+</span> b[I]</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="run-on-host">Run on host<a class="anchor" aria-label="anchor" href="#run-on-host"></a>
</h3>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>dev <span class="op">=</span> <span class="fu">CPU</span>()</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>a <span class="op">=</span> <span class="fu">randn</span>(<span class="dt">Float32</span>, <span class="fl">1024</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>b <span class="op">=</span> <span class="fu">randn</span>(<span class="dt">Float32</span>, <span class="fl">1024</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>c <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float32}</span>(<span class="cn">undef</span>, <span class="fl">1024</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">vector_add</span>(dev, <span class="fl">512</span>)(a, b, c, ndrange<span class="op">=</span><span class="fu">size</span>(a))</span></code></pre>
</div>
<p>We can perform operations on the GPU simply by operating on device
arrays.</p>
<div class="tabs">
<nav><div id="nav-tab-2" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-2-Intel" name="Intel" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Intel" type="button" role="tab" aria-controls="nav-tabpanel-2-Intel" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-2-Intel">
  Intel
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Metal" name="Metal" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Metal" type="button" role="tab" aria-controls="nav-tabpanel-2-Metal" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Metal">
  Metal
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-NVidia" name="NVidia" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-NVidia" type="button" role="tab" aria-controls="nav-tabpanel-2-NVidia" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-NVidia">
  NVidia
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-AMD" name="AMD" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-AMD" type="button" role="tab" aria-controls="nav-tabpanel-2-AMD" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-AMD">
  AMD
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-2" class="tab-content">
<div id="nav-tabpanel-2-Intel" class="tab-pane show active" aria-labelledby="nav-tab-2-Intel" role="tabpanel">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>a_dev <span class="op">=</span> <span class="fu">oneArray</span>(a)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>b_dev <span class="op">=</span> <span class="fu">oneArray</span>(b)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>a_dev <span class="op">.+</span> b_dev</span></code></pre>
</div>
</div>
<div id="nav-tabpanel-2-Metal" class="tab-pane" aria-labelledby="nav-tab-2-Metal" role="tabpanel">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>a_dev <span class="op">=</span> <span class="fu">MtlArray</span>(a)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>b_dev <span class="op">=</span> <span class="fu">MtlArray</span>(b)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>a_dev <span class="op">.+</span> b_dev</span></code></pre>
</div>
</div>
<div id="nav-tabpanel-2-NVidia" class="tab-pane" aria-labelledby="nav-tab-2-NVidia" role="tabpanel">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>a_dev <span class="op">=</span> <span class="fu">CuArray</span>(a)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>b_dev <span class="op">=</span> <span class="fu">CuArray</span>(b)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>a_dev <span class="op">.+</span> b_dev</span></code></pre>
</div>
</div>
<div id="nav-tabpanel-2-AMD" class="tab-pane" aria-labelledby="nav-tab-2-AMD" role="tabpanel">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>a_dev <span class="op">=</span> <span class="fu">ROCArray</span>(a)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>b_dev <span class="op">=</span> <span class="fu">ROCArray</span>(b)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>a_dev <span class="op">.+</span> b_dev</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="computations-on-the-device">Computations on the device<a class="anchor" aria-label="anchor" href="#computations-on-the-device"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>dev <span class="op">=</span> <span class="fu">get_backend</span>(a_dev)</span></code></pre>
</div>
<div id="run-the-vector-add-on-the-device" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="run-the-vector-add-on-the-device" class="callout-inner">
<h3 class="callout-title">Run the vector-add on the device</h3>
<div class="callout-content">
<p>Depending on your machine, try and run the above vector addition on
your GPU. Most PC (Windows or Linux) laptops have an on-board Intel GPU
that can be exploited using <code>oneAPI</code>. If you have a Mac, give
it a shot with <code>Metal</code>. Some of you may have brought a gaming
laptop with a real GPU, then <code>CUDA</code> or <code>AMDGPU</code> is
your choice.</p>
<p>Compare the run time of <code>vector_add</code> to the threaded CPU
version and the array implementation. Make sure to run
<code>KernelAbstractions.synchronize(backend)</code> when you time
results.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>c_dev <span class="op">=</span> <span class="fu">oneArray</span>(<span class="fu">zeros</span>(<span class="dt">Float32</span>, <span class="fl">1024</span>))</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">vector_add</span>(dev, <span class="fl">512</span>)(a_dev, b_dev, c_dev, ndrange<span class="op">=</span><span class="fl">1024</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">Array</span>(c_dev) <span class="op">.==</span> a <span class="op">.+</span> b)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="kw">function</span> <span class="fu">test_vector_add</span>()</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>	<span class="fu">vector_add</span>(dev, <span class="fl">512</span>)(a_dev, b_dev, c_dev, ndrange<span class="op">=</span><span class="fl">1024</span>)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>	KernelAbstractions.<span class="fu">synchronize</span>(dev) </span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">test_vector_add</span>()</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="cf">begin</span> c_dev <span class="op">.=</span> a_dev <span class="op">.+</span> b_dev; KernelAbstractions.<span class="fu">synchronize</span>(dev) <span class="cf">end</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="pp">@benchmark</span> c <span class="op">.=</span> a <span class="op">.+</span> b</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="implement-the-julia-fractal" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="implement-the-julia-fractal" class="callout-inner">
<h3 class="callout-title">Implement the Julia fractal</h3>
<div class="callout-content">
<p>Use the GPU library that is appropriate for your laptop. Do you
manage to get any speedup?</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">julia_host</span>(c<span class="op">::</span><span class="dt">ComplexF32</span>, s<span class="op">::</span><span class="dt">Float32</span>, maxit<span class="op">::</span><span class="dt">Int</span>, out<span class="op">::</span><span class="dt">AbstractMatrix{Int}</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>	w, h <span class="op">=</span> <span class="fu">size</span>(out)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>	<span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> idx <span class="kw">in</span> <span class="fu">CartesianIndices</span>(out)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>		x <span class="op">=</span> (idx[<span class="fl">1</span>] <span class="op">-</span> w <span class="op">÷</span> <span class="fl">2</span>) <span class="op">*</span> s</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>		y <span class="op">=</span> (idx[<span class="fl">2</span>] <span class="op">-</span> h <span class="op">÷</span> <span class="fl">2</span>) <span class="op">*</span> s</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>		z <span class="op">=</span> x <span class="op">+</span> <span class="fl">1f0im</span> <span class="op">*</span> y</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>		out[idx] <span class="op">=</span> maxit</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>		<span class="cf">for</span> k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>maxit</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>			z <span class="op">=</span> z<span class="op">*</span>z <span class="op">+</span> c</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>			<span class="cf">if</span> <span class="fu">abs</span>(z) <span class="op">&gt;</span> <span class="fl">2f0</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>				out[idx] <span class="op">=</span> k</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>				<span class="cf">break</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>			<span class="cf">end</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>		<span class="cf">end</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>c <span class="op">=</span> <span class="op">-</span><span class="fl">0.7269f0</span><span class="op">+</span><span class="fl">0.1889f0im</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>out_host <span class="op">=</span> <span class="fu">Matrix</span><span class="dt">{Int}</span>(<span class="cn">undef</span>, <span class="fl">1920</span>, <span class="fl">1080</span>)</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="fu">julia_host</span>(c, <span class="fl">1f0</span><span class="op">/</span><span class="fl">600</span>, <span class="fl">1024</span>, out_host)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">heatmap</span>(out_host)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">julia_host</span>(c, <span class="fl">1f0</span><span class="op">/</span><span class="fl">600</span>, <span class="fl">1024</span>, out_host)</span></code></pre>
</div>
<p>Hint 1: you need to convert the <code>@index(Global)</code> index
into a <code>(i, j)</code> pair. You can do this by computing the
quotient and remainder to the image width.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>idx <span class="op">=</span> <span class="pp">@index</span>(Global)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>i <span class="op">=</span> (idx<span class="op">-</span><span class="fl">1</span>) <span class="op">%</span> w <span class="op">+</span> <span class="fl">1</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>j <span class="op">=</span> (idx<span class="op">-</span><span class="fl">1</span>) <span class="op">÷</span> w <span class="op">+</span> <span class="fl">1</span></span></code></pre>
</div>
<p>Hint 2: on Intel we needed a gang size that divides the width of the
image, in this case <code>480</code> seemed to work.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="pp">@kernel</span> <span class="kw">function</span> <span class="fu">julia_dev</span>(c<span class="op">::</span><span class="dt">ComplexF32</span>, s<span class="op">::</span><span class="dt">Float32</span>, maxit<span class="op">::</span><span class="dt">Int</span>, out)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>	w, h <span class="op">=</span> <span class="fu">size</span>(out)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>	idx <span class="op">=</span> <span class="pp">@index</span>(Global)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>	i <span class="op">=</span> (idx<span class="op">-</span><span class="fl">1</span>) <span class="op">%</span> w <span class="op">+</span> <span class="fl">1</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>	j <span class="op">=</span> (idx<span class="op">-</span><span class="fl">1</span>) <span class="op">÷</span> w <span class="op">+</span> <span class="fl">1</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>	x <span class="op">=</span> (i <span class="op">-</span> w <span class="op">÷</span> <span class="fl">2</span>) <span class="op">*</span> s</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>	y <span class="op">=</span> (j <span class="op">-</span> h <span class="op">÷</span> <span class="fl">2</span>) <span class="op">*</span> s</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>	z <span class="op">=</span> x <span class="op">+</span> <span class="fl">1f0im</span> <span class="op">*</span> y</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>	out[idx] <span class="op">=</span> maxit</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>	<span class="cf">for</span> k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>maxit</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>		z <span class="op">=</span> z<span class="op">*</span>z <span class="op">+</span> c</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>		<span class="cf">if</span> <span class="fu">abs</span>(z) <span class="op">&gt;</span> <span class="fl">2f0</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>			out[idx] <span class="op">=</span> k</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>			<span class="cf">break</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>		<span class="cf">end</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>out <span class="op">=</span> <span class="fu">oneArray</span>(<span class="fu">zeros</span>(<span class="dt">Int</span>, <span class="fl">1920</span>, <span class="fl">1080</span>))</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>backend <span class="op">=</span> <span class="fu">get_backend</span>(out)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="fu">julia_dev</span>(backend, <span class="fl">480</span>)(c, <span class="fl">1f0</span><span class="op">/</span><span class="fl">600</span>, <span class="fl">1024</span>, out, ndrange<span class="op">=</span><span class="fu">size</span>(out))</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">Array</span>(out) <span class="op">.==</span> out_host)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="cf">begin</span> <span class="fu">julia_dev</span>(backend, <span class="fl">480</span>)(c, <span class="fl">1f0</span><span class="op">/</span><span class="fl">600</span>, <span class="fl">1024</span>, out, ndrange<span class="op">=</span><span class="fu">size</span>(out)); KernelAbstractions.<span class="fu">synchronize</span>(backend) <span class="cf">end</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>We can compile Julia code to GPU backends using
<code>KernelAbstractions</code>.</li>
<li>Even on smaller laptops, significant speedups can be achieved, given
the right problem.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-a01-collatz"><p>Content from <a href="a01-collatz.html">Appendix: Iterators and type stability</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/a01-collatz.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>I tried to be smart, but now my code is slow. What happened?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how iterators work under the hood.</li>
<li>Understand why parametric types can improve performance.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This example is inspired on <a href="https://juliafolds.github.io/data-parallelism/tutorials/quick-introduction/" class="external-link">material
by Takafumi Arakaki</a>.</p>
<p>The Collatz conjecture states that the integer sequence</p>
<p><span class="math display">\[x_{i+1} = \begin{cases}x_i / 2
&amp;\text{if $x_i$ is even}\\
	3x_i + 1 &amp;\text{if $x_i$ is odd}
\end{cases}\]</span></p>
<p>reaches the number <span class="math inline">\(1\)</span> for all
starting numbers <span class="math inline">\(x_0\)</span>.</p>
<div class="codewrapper sourceCode" id="a-collatz">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="a-collatz-1"><a href="#a-collatz-1" tabindex="-1"></a><span class="fu">collatz</span>(x) <span class="op">=</span> <span class="fu">iseven</span>(x) ? x <span class="op">÷</span> <span class="fl">2</span> <span class="op">:</span> <span class="fl">3</span>x <span class="op">+</span> <span class="fl">1</span></span></code></pre>
</div>
<section><h2 class="section-heading" id="stopping-time">Stopping time<a class="anchor" aria-label="anchor" href="#stopping-time"></a>
</h2>
<hr class="half-width">
<p>We can try to test the Collatz conjecture for some initial numbers,
by checking how long they take to reach <span class="math inline">\(1\)</span>. A simple implementation would be as
follows:</p>
<div class="codewrapper sourceCode" id="count-until">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="count-until-1"><a href="#count-until-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">count_until_fn</span>(pred, fn, init)</span>
<span id="count-until-2"><a href="#count-until-2" tabindex="-1"></a>  n <span class="op">=</span> <span class="fl">1</span></span>
<span id="count-until-3"><a href="#count-until-3" tabindex="-1"></a>  x <span class="op">=</span> init</span>
<span id="count-until-4"><a href="#count-until-4" tabindex="-1"></a>  <span class="cf">while</span> <span class="cn">true</span></span>
<span id="count-until-5"><a href="#count-until-5" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">pred</span>(x)</span>
<span id="count-until-6"><a href="#count-until-6" tabindex="-1"></a>      <span class="cf">return</span> n</span>
<span id="count-until-7"><a href="#count-until-7" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="count-until-8"><a href="#count-until-8" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">fn</span>(x)</span>
<span id="count-until-9"><a href="#count-until-9" tabindex="-1"></a>    n <span class="op">+=</span> <span class="fl">1</span></span>
<span id="count-until-10"><a href="#count-until-10" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="count-until-11"><a href="#count-until-11" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="a-collatz">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="a-collatz-1"><a href="#a-collatz-1" tabindex="-1"></a><span class="fu">collatz_stopping_time_v1</span>(n<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="fu">count_until_fn</span>(<span class="op">==</span>(<span class="fl">1</span>), collatz, n)</span></code></pre>
</div>
<p>This is nice. We have a reusable function that counts how many times
we need to recursively apply a function, until we reach a preset
condition (predicate). However, in Julia there is a deeper abstraction
for iterators, called iterators.</p>
<p>The <code>count_until</code> function for iterators becomes a little
more intuitive.</p>
<div class="codewrapper sourceCode" id="count-until">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="count-until-1"><a href="#count-until-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">count_until</span>(pred, iterator)</span>
<span id="count-until-2"><a href="#count-until-2" tabindex="-1"></a>  <span class="cf">for</span> (i, <span class="cn">e</span>) <span class="kw">in</span> <span class="fu">enumerate</span>(iterator)</span>
<span id="count-until-3"><a href="#count-until-3" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">pred</span>(<span class="cn">e</span>)</span>
<span id="count-until-4"><a href="#count-until-4" tabindex="-1"></a>      <span class="cf">return</span> i</span>
<span id="count-until-5"><a href="#count-until-5" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="count-until-6"><a href="#count-until-6" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="count-until-7"><a href="#count-until-7" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span><span class="fl">1</span></span>
<span id="count-until-8"><a href="#count-until-8" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>Now, all we need to do is write an iterator for our recursion.</p>
<div id="iterators" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="iterators" class="callout-inner">
<h3 class="callout-title">Iterators</h3>
<div class="callout-content">
<p>Custom iterators in Julia are implemented using the
<code>Base.iterate</code> method. This is one way to create lazy
collections or even infinite ones. We can write an iterator that takes a
function and iterates over its results recursively.</p>
<p>We implement two instances of <code>Base.iterate</code>: one is the
initializer</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">iterate</span><span class="er">(</span><span class="ex">i::Iterator</span><span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> <span class="er">(</span><span class="ex">item_0,</span> state_0<span class="kw">)</span></span></code></pre>
</div>
<p>the second handles all consecutive calls</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">iterate</span><span class="er">(</span><span class="ex">i::Iterator,</span> state_n<span class="kw">)</span> <span class="ex">-</span><span class="op">&gt;</span> <span class="er">(</span><span class="ex">item_n+1,</span> state_n+1<span class="kw">)</span></span></code></pre>
</div>
<p>Then, many functions also need to know the size of the iterator,
through <code>Base.IteratorSize(::Iterator)</code>. In our case this is
<code>IsInfinite()</code>. If you know the length in advance, also
implement <code>Base.length</code>.</p>
<p>You may also want to implement <code>Base.IteratorEltype()</code> and
<code>Base.eltype</code>.</p>
<p>Later on, we will see how we can achieve similar results using
channels.</p>
<p><a href="https://docs.julialang.org/en/v1/base/collections/#lib-collections-iteration" class="external-link">Reference</a></p>
</div>
</div>
</div>
<p>Our new iterator can compute the next state from the previous value,
so state and emitted value will be the same in this example.</p>
<div class="codewrapper sourceCode" id="iterated-untyped">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="iterated-untyped-1"><a href="#iterated-untyped-1" tabindex="-1"></a><span class="kw">struct</span> Iterated</span>
<span id="iterated-untyped-2"><a href="#iterated-untyped-2" tabindex="-1"></a>  fn</span>
<span id="iterated-untyped-3"><a href="#iterated-untyped-3" tabindex="-1"></a>  init</span>
<span id="iterated-untyped-4"><a href="#iterated-untyped-4" tabindex="-1"></a><span class="kw">end</span></span>
<span id="iterated-untyped-5"><a href="#iterated-untyped-5" tabindex="-1"></a></span>
<span id="iterated-untyped-6"><a href="#iterated-untyped-6" tabindex="-1"></a><span class="fu">iterated</span>(fn) <span class="op">=</span> init <span class="op">-&gt;</span> <span class="fu">Iterated</span>(fn, init)</span>
<span id="iterated-untyped-7"><a href="#iterated-untyped-7" tabindex="-1"></a><span class="fu">iterated</span>(fn, init) <span class="op">=</span> <span class="fu">Iterated</span>(fn, init)</span>
<span id="iterated-untyped-8"><a href="#iterated-untyped-8" tabindex="-1"></a></span>
<span id="iterated-untyped-9"><a href="#iterated-untyped-9" tabindex="-1"></a><span class="kw">function</span> <span class="bu">Base</span>.<span class="fu">iterate</span>(i<span class="op">::</span><span class="dt">Iterated</span>)</span>
<span id="iterated-untyped-10"><a href="#iterated-untyped-10" tabindex="-1"></a>  i.init, i.init</span>
<span id="iterated-untyped-11"><a href="#iterated-untyped-11" tabindex="-1"></a><span class="kw">end</span></span>
<span id="iterated-untyped-12"><a href="#iterated-untyped-12" tabindex="-1"></a></span>
<span id="iterated-untyped-13"><a href="#iterated-untyped-13" tabindex="-1"></a><span class="kw">function</span> <span class="bu">Base</span>.<span class="fu">iterate</span>(i<span class="op">::</span><span class="dt">Iterated</span>, state)</span>
<span id="iterated-untyped-14"><a href="#iterated-untyped-14" tabindex="-1"></a>  x <span class="op">=</span> i.<span class="fu">fn</span>(state)</span>
<span id="iterated-untyped-15"><a href="#iterated-untyped-15" tabindex="-1"></a>  x, x</span>
<span id="iterated-untyped-16"><a href="#iterated-untyped-16" tabindex="-1"></a><span class="kw">end</span></span>
<span id="iterated-untyped-17"><a href="#iterated-untyped-17" tabindex="-1"></a></span>
<span id="iterated-untyped-18"><a href="#iterated-untyped-18" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">IteratorSize</span>(<span class="op">::</span><span class="dt">Iterated</span>) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">IsInfinite</span>()</span>
<span id="iterated-untyped-19"><a href="#iterated-untyped-19" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">IteratorEltype</span>(<span class="op">::</span><span class="dt">Iterated</span>) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">EltypeUnknown</span>()</span></code></pre>
</div>
<p>There is a big problem with this implementation: it is slow as
molasses. We don’t know the types of the members of
<code>Recursion</code> before hand, and neither does the compiler. The
compiler will see a <code>iterate(::Recursion)</code> implementation
that can contain members of any type. This means that the return value
tuple needs to be dynamically allocated, and the call
<code>i.fn(state)</code> is indeterminate.</p>
<p>We can make this code a lot faster by writing a generic function
implementation, that specializes for every case that we encounter.</p>
<div id="function-types" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="function-types" class="callout-inner">
<h3 class="callout-title">Function types</h3>
<div class="callout-content">
<p>In Julia, every function has its own unique type. There is an
overarching abstract <code>Function</code> type, but not all function
objects (that implement <code>(::T)(args...)</code> semantics) derive
from that class. The only way to capture function types statically is by
making them generic, as in the following example.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="iterated">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="iterated-1"><a href="#iterated-1" tabindex="-1"></a><span class="kw">struct</span> Iterated{Fn,T}</span>
<span id="iterated-2"><a href="#iterated-2" tabindex="-1"></a>  fn<span class="op">::</span><span class="dt">Fn</span></span>
<span id="iterated-3"><a href="#iterated-3" tabindex="-1"></a>  init<span class="op">::</span><span class="dt">T</span></span>
<span id="iterated-4"><a href="#iterated-4" tabindex="-1"></a><span class="kw">end</span></span>
<span id="iterated-5"><a href="#iterated-5" tabindex="-1"></a></span>
<span id="iterated-6"><a href="#iterated-6" tabindex="-1"></a><span class="fu">iterated</span>(fn) <span class="op">=</span> init <span class="op">-&gt;</span> <span class="fu">Iterated</span>(fn, init)</span>
<span id="iterated-7"><a href="#iterated-7" tabindex="-1"></a><span class="fu">iterated</span>(fn, init) <span class="op">=</span> <span class="fu">Iterated</span>(fn, init)</span>
<span id="iterated-8"><a href="#iterated-8" tabindex="-1"></a></span>
<span id="iterated-9"><a href="#iterated-9" tabindex="-1"></a><span class="kw">function</span> <span class="bu">Base</span>.<span class="fu">iterate</span>(i<span class="op">::</span><span class="dt">Iterated{Fn,T}</span>) <span class="kw">where</span> {Fn,T}</span>
<span id="iterated-10"><a href="#iterated-10" tabindex="-1"></a>  i.init, i.init</span>
<span id="iterated-11"><a href="#iterated-11" tabindex="-1"></a><span class="kw">end</span></span>
<span id="iterated-12"><a href="#iterated-12" tabindex="-1"></a></span>
<span id="iterated-13"><a href="#iterated-13" tabindex="-1"></a><span class="kw">function</span> <span class="bu">Base</span>.<span class="fu">iterate</span>(i<span class="op">::</span><span class="dt">Iterated{Fn,T}</span>, state<span class="op">::</span><span class="dt">T</span>) <span class="kw">where</span> {Fn,T}</span>
<span id="iterated-14"><a href="#iterated-14" tabindex="-1"></a>  x <span class="op">=</span> i.<span class="fu">fn</span>(state)</span>
<span id="iterated-15"><a href="#iterated-15" tabindex="-1"></a>  x, x</span>
<span id="iterated-16"><a href="#iterated-16" tabindex="-1"></a><span class="kw">end</span></span>
<span id="iterated-17"><a href="#iterated-17" tabindex="-1"></a></span>
<span id="iterated-18"><a href="#iterated-18" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">IteratorSize</span>(<span class="op">::</span><span class="dt">Iterated</span>) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">IsInfinite</span>()</span>
<span id="iterated-19"><a href="#iterated-19" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">IteratorEltype</span>(<span class="op">::</span><span class="dt">Iterated</span>) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">HasEltype</span>()</span>
<span id="iterated-20"><a href="#iterated-20" tabindex="-1"></a><span class="bu">Base</span>.<span class="fu">eltype</span>(<span class="op">::</span><span class="dt">Iterated{Fn,T}</span>) <span class="kw">where</span> {Fn,T} <span class="op">=</span> T</span></code></pre>
</div>
<p>With this definition for <code>Recursion</code>, we can write our new
function for the Collatz stopping time:</p>
<div class="codewrapper sourceCode" id="a-collatz">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="a-collatz-1"><a href="#a-collatz-1" tabindex="-1"></a><span class="fu">collatz_stopping_time_v2</span>(n<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="fu">count_until</span>(<span class="op">==</span>(<span class="fl">1</span>), <span class="fu">recurse</span>(collatz, n))</span></code></pre>
</div>
<p>Retrieving the same run times as we had with our first
implementation.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Collatz module
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3" file="examples/Collatz/src/Collatz.jl">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">module</span> Collatz</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="op">&lt;&lt;</span>count<span class="op">-</span>until<span class="op">&gt;&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="op">&lt;&lt;</span>iterated<span class="op">&gt;&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="op">&lt;&lt;</span>a<span class="op">-</span>collatz<span class="op">&gt;&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="kw">end</span> <span class="co"># module Collatz</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>When things are slow, try adding more types.</li>
<li>Writing abstract code that is also performant is not easy.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-a02-julia-fractals"><p>Content from <a href="a02-julia-fractals.html">Appendix: Generating Julia Fractals</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/a02-julia-fractals.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>It is not known where the name Julia for the programming language
originated. Still, it might be fitting to look into the Julia fractal,
named after the French mathematician Gaston Maurice Julia.</p>
<p>The map</p>
<p><span class="math display">\[J_c: z \mapsto z^2 + c,\]</span></p>
<p>is iterated for a given constant <span class="math inline">\(c\)</span>.</p>
<div class="codewrapper sourceCode" id="julia-fractal">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="julia-fractal-1"><a href="#julia-fractal-1" tabindex="-1"></a><span class="fu">julia</span>(c) <span class="op">=</span> z <span class="op">-&gt;</span> z<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> c</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA EVAL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia eval" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#| session: a02</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="op">&lt;&lt;</span>julia<span class="op">-</span>fractal<span class="op">&gt;&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="op">&lt;&lt;</span>iterated<span class="op">&gt;&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="im">using</span> <span class="bu">Iterators</span>: take</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">take</span>(<span class="fu">iterated</span>(<span class="fu">julia</span>(c), <span class="fl">0.0</span>), <span class="fl">20</span>) <span class="op">|&gt;</span> collect</span></code></pre>
</div>
<p>We may plot the behaviour depending on the value of <span class="math inline">\(c\)</span>.</p>
<figure><img src="fig/a02-real-orbits.svg" alt="julia orbits" class="figure mx-auto d-block"><div class="figcaption">Orbits of <span class="math inline">\(z=z^2+c\)</span> for real values</div>
</figure><p>For any starting position <span class="math inline">\(z_0\)</span>,
we can see if the series produced by iterating over <span class="math inline">\(J_c\)</span>. The question is whether this series
then diverges or not.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb2" file="examples/JuliaFractal/src/JuliaFractal.jl">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">module</span> JuliaFractal</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">using</span> <span class="bu">Transducers</span>: Iterated, Enumerate, Map, Take, DropWhile</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="kw">module</span> MyIterators</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="op">&lt;&lt;</span>count<span class="op">-</span>until<span class="op">&gt;&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="op">&lt;&lt;</span>iterated<span class="op">&gt;&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="op">&lt;&lt;</span>julia<span class="op">-</span>fractal<span class="op">&gt;&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="kw">struct</span> BoundingBox</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    shape<span class="op">::</span><span class="dt">NTuple{2,Int}</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>    origin<span class="op">::</span><span class="dt">ComplexF64</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    resolution<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="fu">bounding_box</span>(; width<span class="op">::</span><span class="dt">Int</span>, height<span class="op">::</span><span class="dt">Int</span>, center<span class="op">::</span><span class="dt">ComplexF64</span>, resolution<span class="op">::</span><span class="dt">Float64</span>) <span class="op">=</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>    <span class="fu">BoundingBox</span>(</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>        (width, height),</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>        center <span class="op">-</span> (resolution <span class="op">*</span> width <span class="op">/</span> <span class="fl">2</span>) <span class="op">-</span> (resolution <span class="op">*</span> height <span class="op">/</span> <span class="fl">2</span>)<span class="cn">im</span>,</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>        resolution)</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="fu">grid</span>(box<span class="op">::</span><span class="dt">BoundingBox</span>) <span class="op">=</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>    ((idx[<span class="fl">1</span>] <span class="op">*</span> box.resolution) <span class="op">+</span> (idx[<span class="fl">2</span>] <span class="op">*</span> box.resolution)<span class="cn">im</span> <span class="op">+</span> box.origin</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>     <span class="cf">for</span> idx <span class="kw">in</span> <span class="fu">CartesianIndices</span>(box.shape))</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="fu">axes</span>(box<span class="op">::</span><span class="dt">BoundingBox</span>) <span class="op">=</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>    ((<span class="fl">1</span><span class="op">:</span>box.shape[<span class="fl">1</span>]) <span class="op">.*</span> box.resolution <span class="op">.+</span> <span class="fu">real</span>(box.origin),</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>        (<span class="fl">1</span><span class="op">:</span>box.shape[<span class="fl">2</span>]) <span class="op">.*</span> box.resolution <span class="op">.+</span> <span class="fu">imag</span>(box.origin))</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="fu">escape_time</span>(fn<span class="op">::</span><span class="dt">Fn</span>, maxit<span class="op">::</span><span class="dt">Int64</span>) <span class="kw">where</span> {Fn} <span class="op">=</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>    <span class="kw">function</span> (z<span class="op">::</span><span class="dt">Complex{T}</span>) <span class="kw">where</span> {T<span class="op">&lt;:</span><span class="dt">Real</span>}</span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>        MyIterators.<span class="fu">count_until</span>(</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>            (z<span class="op">::</span><span class="dt">Complex{T}</span>) <span class="op">-&gt;</span> <span class="fu">real</span>(z <span class="op">*</span> <span class="fu">conj</span>(z)) <span class="op">&gt;</span> <span class="fl">4.0</span>,</span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>            <span class="bu">Iterators</span>.<span class="fu">take</span>(MyIterators.<span class="fu">iterated</span>(fn, z), maxit))</span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="fu">escape_time_3</span>(fn, maxit) <span class="op">=</span> <span class="kw">function</span> (z)</span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>    <span class="bu">Iterators</span>.<span class="fu">dropwhile</span>(</span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>        ((i, z),) <span class="op">-&gt;</span> <span class="fu">real</span>(z <span class="op">*</span> <span class="fu">conj</span>(z)) <span class="op">&lt;</span> <span class="fl">4.0</span>,</span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>        <span class="fu">enumerate</span>(<span class="bu">Iterators</span>.<span class="fu">take</span>(MyIterators.<span class="fu">iterated</span>(fn, z), maxit))</span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>    ) <span class="op">|&gt;</span> first <span class="op">|&gt;</span> first</span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="fu">escape_time_2</span>(fn, maxit) <span class="op">=</span> <span class="kw">function</span> (z)</span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>    MyIterators.<span class="fu">iterated</span>(fn, z) <span class="op">|&gt;</span> <span class="fu">Enumerate</span>() <span class="op">|&gt;</span> <span class="fu">Take</span>(maxit) <span class="op">|&gt;</span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>    <span class="fu">DropWhile</span>(((i, z),) <span class="op">-&gt;</span> <span class="fu">real</span>(z <span class="op">*</span> <span class="fu">conj</span>(z)) <span class="op">&lt;</span> <span class="fl">4.0</span>) <span class="op">|&gt;</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>    first <span class="op">|&gt;</span> first</span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_julia</span>(z<span class="op">::</span><span class="dt">Complex{T}</span>) <span class="kw">where</span> {T<span class="op">&lt;:</span><span class="dt">Real</span>}</span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a>    width <span class="op">=</span> <span class="fl">1920</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a>    height <span class="op">=</span> <span class="fl">1080</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a>    bbox <span class="op">=</span> <span class="fu">bounding_box</span>(width<span class="op">=</span>width, height<span class="op">=</span>height, center<span class="op">=</span><span class="fl">0.0</span> <span class="op">+</span> <span class="fl">0.0im</span>, resolution<span class="op">=</span><span class="fl">0.004</span>)</span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>    image <span class="op">=</span> <span class="fu">grid</span>(bbox) <span class="op">.|&gt;</span> <span class="fu">escape_time</span>(<span class="fu">julia</span>(z), <span class="fl">512</span>)</span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>])</span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a>    x, y <span class="op">=</span> <span class="fu">axes</span>(bbox)</span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a>    <span class="fu">heatmap!</span>(ax, x, y, image)</span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a><span class="kw">end</span>  <span class="co"># module</span></span></code></pre>
</div>
</div>
</div>
</div>
</div></section><section id="aio-a03-lorenz-attractor"><p>Content from <a href="a03-lorenz-attractor.html">Appendix: Lorenz attractor</a></p>
<hr>
<p>Last updated on 2025-01-12 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/a03-lorenz-attractor.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>The Lorenz attractor is a famous example of a dynamic system with
chaotic behaviour. That means that the behaviour of this system has a
particular high sensitivity to input parameters and initial conditions.
The system consists of three coupled differential equations:</p>
<p><span class="math display">\[\partial_t x = \sigma (y - z),\]</span>
<span class="math display">\[\partial_t y = x (\rho - z) - y,\]</span>
<span class="math display">\[\partial_t z = xy - \beta z,\]</span></p>
<p>where <span class="math inline">\(x, y, z\)</span> is the
configuration space and <span class="math inline">\(\sigma,
\rho\)</span> and <span class="math inline">\(\beta\)</span> are
parameters.</p>
<div class="codewrapper sourceCode" id="cb1" file="examples/Lorenz/src/Lorenz.jl">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">module</span> Lorenz</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="pp">@kwdef</span> <span class="kw">struct</span> Parameters</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    sigma<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    rho<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    beta<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="kw">mutable struct</span> State</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    y<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    z<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/" class="external-link">Source</a></p>
				<p><a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:j.hidding@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, Julia, lesson",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/aio.html",
  "identifier": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/aio.html",
  "dateCreated": "2024-01-01",
  "dateModified": "2025-01-14",
  "datePublished": "2025-01-14"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->


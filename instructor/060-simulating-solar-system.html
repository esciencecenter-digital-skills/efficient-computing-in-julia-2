<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Efficient Computing in Julia: Simulating the Solar System</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../060-simulating-solar-system.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Efficient Computing in Julia
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Efficient Computing in Julia
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Efficient Computing in Julia
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 30%" class="percentage">
    30%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 30%" aria-valuenow="30" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../060-simulating-solar-system.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="020-getting-started.html">1. Getting Started</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="030-julia-basics.html">2. Introduction to Julia</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="040-dispatch-and-types.html">3. Types and Dispatch</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        4. Simulating the Solar System
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction-to-unitful">Introduction to <code>Unitful</code></a></li>
<li><a href="#particles">Particles</a></li>
<li><a href="#the-kick">The kick</a></li>
<li><a href="#with-random-particles">With random particles</a></li>
<li><a href="#solar-system">Solar System</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="070-pkg.html">5. Packages and environments</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="080-package-development.html">6. Package development</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="090-best-practices.html">7. Best practices</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="100-introduction-performance.html">8. Julia and performance</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="110-performance-analysis.html">9. Reducing allocations on the Logistic Map</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="120-dos-and-donts.html">10. Performance: do's and don'ts</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="130-channels-and-do.html">11. Channels and <code>do</code>-syntax</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="140-threads-async-and-tasks.html">12. Getting Started</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="145-distributed.html">13. Getting Started</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="150-transducers.html">14. Transducers</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="160-cool-libraries.html">15. Recommended libraries</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush17">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading17">
        <a href="170-gpu-programming.html">16. GPU Programming</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush18">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading18">
        <a href="a01-collatz.html">17. Appendix: Iterators and type stability</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush19">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading19">
        <a href="a02-julia-fractals.html">18. Appendix: Generating Julia Fractals</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush20">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading20">
        <a href="a03-lorenz-attractor.html">19. Appendix: Lorenz attractor</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/040-dispatch-and-types.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/070-pkg.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/040-dispatch-and-types.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Types and Dispatch
        </a>
        <a class="chapter-link float-end" href="../instructor/070-pkg.html" rel="next">
          Next: Packages and...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Simulating the Solar System</h1>
        <p>Last updated on 2025-01-14 |

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/060-simulating-solar-system.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>





        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I work with physical units?</li>
<li>How do I quickly visualize some data?</li>
<li>How is dispatch used in practice?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn to work with <code>Unitful</code>
</li>
<li>Take the first steps with <code>Makie</code> for visualisation</li>
<li>Work with <code>const</code>
</li>
<li>Define a <code>struct</code>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<p>In this episode we’ll be building a simulation of the solar system.
That is, we’ll only consider the Sun, Earth and Moon, but feel free to
add other planets to the mix later on! To do this we need to work with
the laws of gravity. We will be going on extreme tangents, exposing
interesting bits of the Julia language as we go.</p>
<section><h2 class="section-heading" id="introduction-to-unitful">Introduction to <code>Unitful</code>
<a class="anchor" aria-label="anchor" href="#introduction-to-unitful"></a></h2>
<hr class="half-width"><p>We’ll be using the <code>Unitful</code> library to ensure that we
don’t mix up physical units.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span></code></pre>
</div>
<p>Using <code>Unitful</code> is without any run-time overhead. The unit
information is completely contained in the <code>Quantity</code> type.
With <code>Unitful</code> we can attach units to quantities using the
<code>@u_str</code> syntax:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fl">1.0</span>u<span class="st">"kg"</span> <span class="op">==</span> <span class="fl">1000.0</span>u<span class="st">"g"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fl">2.0</span>u<span class="st">"m"</span> <span class="op">-</span> <span class="fl">8.0</span>u<span class="st">"cm"</span></span></code></pre>
</div>
<div id="try-adding-incompatible-quantities" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="try-adding-incompatible-quantities" class="callout-inner">
<h3 class="callout-title">Try adding incompatible quantities</h3>
<div class="callout-content">
<p>For instance, add a quantity in meters to one in seconds. Be
creative. Can you understand the error messages?</p>
</div>
</div>
</div>
<p>Next to that, we use the <code>Vec3d</code> type from
<code>GeometryBasics</code> to store vector particle positions.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeometryBasics</span></span></code></pre>
</div>
<p>Libraries in Julia tend to work well together, even if they’re not
principally designed to do so. We can combine <code>Vec3d</code> with
<code>Unitful</code> with no problems.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">Vec3d</span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>)u<span class="st">"km"</span></span></code></pre>
</div>
<div id="generate-random-vec3d" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="generate-random-vec3d" class="callout-inner">
<h3 class="callout-title">Generate random Vec3d</h3>
<div class="callout-content">
<p>The <code>Vec3d</code> type is a static 3-vector of double precision
floating point values. Read the documentation on the <a href="https://docs.julialang.org/en/v1/stdlib/Random/#Base.randn" class="external-link"><code>randn</code>
function</a>. Can you figure out a way to generate a random
<code>Vec3d</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>One way is to generate three random numbers and convert the resulting
array to a <code>Vec3d</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">Vec3d</span>(<span class="fu">randn</span>(<span class="dt">Float64</span>, <span class="fl">3</span>))</span></code></pre>
</div>
<p>But it is even better to call <code>randn</code> with the
<code>Vec3d</code> argument directly:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">randn</span>(Vec3d)</span></code></pre>
</div>
<p>(We can time these using <code>@btime</code> from
<code>BenchmarkTools</code>)</p>
</div>
</div>
</div>
</div>
<p>Two bodies of mass <span class="math inline">\(M\)</span> and <span class="math inline">\(m\)</span> attract each other with the force</p>
<p><span class="math display">\[F = \frac{GMm}{r^2},\]</span></p>
<p>where <span class="math inline">\(r\)</span> is the distance between
those bodies, and <span class="math inline">\(G\)</span> is the
universal gravitational constant.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="kw">const</span> G <span class="op">=</span> <span class="fl">6.6743e-11</span>u<span class="st">"m^3*kg^-1*s^-2"</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">gravitational_force</span>(m1, m2, r) <span class="op">=</span> G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">/</span> r<span class="op">^</span><span class="fl">2</span></span></code></pre>
</div>
<p>Verify that the force exerted between two 1 million kg bodies at a
distance of 2.5 meters is about equal to holding a 1kg object on Earth.
Or equivalently two one tonne objects at a distance of 2.5 mm (all of
the one tonne needs to be concentrated in a space tiny enough to get two
of them at that close a distance)</p>
<p>A better way to write the force would be,</p>
<p><span class="math display">\[\vec{F} = \hat{r} \frac{G M
m}{|r|^2},\]</span></p>
<p>where <span class="math inline">\(\hat{r} = \vec{r} / |r|\)</span>,
so in total we get a third power, <span class="math inline">\(|r|^3 =
(r^2)^{3/2}\)</span>, where <span class="math inline">\(r^2\)</span> can
be computed with the dot-product.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">gravitational_force</span>(m1, m2, r<span class="op">::</span><span class="dt">AbstractVector</span>) <span class="op">=</span> r <span class="op">*</span> (G <span class="op">*</span> m1 <span class="op">*</span> m2 <span class="op">*</span> (r <span class="op">⋅</span> r)<span class="op">^</span>(<span class="op">-</span><span class="fl">1.5</span>))</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">gravitational_force</span>(<span class="fl">1e3</span>u<span class="st">"kg"</span>, <span class="fl">1e3</span>u<span class="st">"kg"</span>, <span class="fu">Vec3d</span>(<span class="fl">2.5</span>, <span class="fl">0</span>, <span class="fl">0</span>)u<span class="st">"mm"</span>) <span class="op">.|&gt;</span> u<span class="st">"N"</span></span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Not all of you will be jumping up and down for doing high-school
physics. We will get to other sciences than physics later in this
workshop, I promise!</p>
</div>
</div>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The <code>⋅</code> operator (enter using
<code>\cdot&lt;TAB&gt;</code>) performs the
<code>LinearAlgebra.dot</code> function. We could have done
<code>sum(r * r)</code>. However, the <code>sum</code> function works on
iterators and has a generic implementation. We could define our own
<code>dot</code> function:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dot</span>(a<span class="op">::</span><span class="dt">AbstractVector{T}</span>, b<span class="op">::</span><span class="dt">AbstractVector{T}</span>) <span class="kw">where</span> {T}</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    Prod <span class="op">=</span> <span class="fu">typeof</span>(<span class="fu">zero</span>(T) <span class="op">*</span> <span class="fu">zero</span>(T))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>	x <span class="op">=</span> <span class="fu">zero</span>(Prod)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>	<span class="pp">@simd</span> ivdep <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(a)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>		x <span class="op">+=</span> a[i] <span class="op">*</span> b[i]</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>	<span class="cf">end</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>	<span class="cf">return</span> x</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>If we look for the source</p>
<pre><code>@which LinearAlgebra.dot(a, b)</code></pre>
<p>We find that we’re actually running the dot product from the
<code>StaticArrays</code> library, which has a very similar
implementation as ours.</p>
</div>
</div>
</div>
<div id="the-zero-function" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-zero-function" class="callout-inner">
<h3 class="callout-title">The <code>zero</code> function</h3>
<div class="callout-content">
<p>The <code>zero</code> function is overloaded to return a zero object
for any type that has a natural definition of zero.</p>
</div>
</div>
</div>
<div id="the-one-function" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="the-one-function" class="callout-inner">
<h3 class="callout-title">The <code>one</code> function</h3>
<div class="callout-content">
<p>The return-value of <code>zero</code> should be the additive identity
of the given type. So for any type <code>T</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">let</span> T <span class="op">=</span> <span class="dt">Int</span>, x <span class="op">=</span> <span class="fu">rand</span>(T); x <span class="op">==</span> x <span class="op">+</span> <span class="fu">zero</span>(T) <span class="kw">end</span></span></code></pre>
</div>
<p>There also is the <code>one</code> function which returns the
multiplicative identity of a given type. Try to use the <code>*</code>
operator on two strings. What do you expect <code>one(String)</code> to
return?</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="particles">Particles<a class="anchor" aria-label="anchor" href="#particles"></a></h2>
<hr class="half-width"><p>We are now ready to define the <code>Particle</code> type.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span>: Mass, Length, Velocity</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="kw">mutable struct</span> Particle</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    mass<span class="op">::</span><span class="dt">typeof</span>(<span class="fl">1.0</span>u<span class="st">"kg"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    position<span class="op">::</span><span class="dt">typeof</span>(<span class="fu">Vec3d</span>(<span class="fl">1</span>)u<span class="st">"m"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    momentum<span class="op">::</span><span class="dt">typeof</span>(<span class="fu">Vec3d</span>(<span class="fl">1</span>)u<span class="st">"kg*m/s"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="fu">Particle</span>(mass<span class="op">::</span><span class="dt">Mass</span>, position<span class="op">::</span><span class="dt">Vec3{L}</span>, velocity<span class="op">::</span><span class="dt">Vec3{V}</span>) <span class="kw">where</span> {L<span class="op">&lt;:</span><span class="dt">Length</span>,V<span class="op">&lt;:</span><span class="dt">Velocity</span>} <span class="op">=</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    <span class="fu">Particle</span>(mass, position, velocity <span class="op">*</span> mass)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="fu">velocity</span>(p<span class="op">::</span><span class="dt">Particle</span>) <span class="op">=</span> p.momentum <span class="op">/</span> p.mass</span></code></pre>
</div>
<p>We store the momentum of the particle, so that what follows is
slightly simplified.</p>
<p>It is custom to divide the computation of orbits into a <em>kick</em>
and <em>drift</em> function. (There are deep mathematical reasons for
this that we won’t get into.) We’ll first implement the
<code>kick!</code> function, that updates a collection of particles,
given a certain time step.</p>
</section><section><h2 class="section-heading" id="the-kick">The kick<a class="anchor" aria-label="anchor" href="#the-kick"></a></h2>
<hr class="half-width"><p>The following function performs the <code>kick!</code> operation on a
set of particles. We’ll go on a little tangent for every line in the
function.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">kick!</span>(particles, dt)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(particles)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>(i<span class="op">-</span><span class="fl">1</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>            r <span class="op">=</span> particles[j].position <span class="op">-</span> particles[i].position</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>            force <span class="op">=</span> <span class="fu">gravitational_force</span>(particles[i].mass, particles[j].mass, r)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>            particles[i].momentum <span class="op">+=</span> dt <span class="op">*</span> force</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>            particles[j].momentum <span class="op">-=</span> dt <span class="op">*</span> force</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>    <span class="cf">return</span> particles</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div id="why-the-exclamation-mark" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-the-exclamation-mark" class="callout-inner">
<h3 class="callout-title">Why the <code>!</code> exclamation mark?</h3>
<div class="callout-content">
<p>In Julia it is custom to have an exclamation mark at the end of names
of functions that mutate their arguments.</p>
</div>
</div>
</div>
<div id="use-eachindex" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="use-eachindex" class="callout-inner">
<h3 class="callout-title">Use <code>eachindex</code>
</h3>
<div class="callout-content">
<p>Note the way we used <code>eachindex</code>. This idiom guarantees
that we can’t make out-of-bounds errors. Also this kind of indexing is
generic over other collections than vectors. However, this is
immediately destroyed by our next loop.</p>
</div>
</div>
</div>
<div id="broadcasting-vs.-specialization" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="broadcasting-vs.-specialization" class="callout-inner">
<h3 class="callout-title">Broadcasting vs. specialization</h3>
<div class="callout-content">
<p>We’re subtracting two vectors. We could have written that with
dot-notation indicating a broadcasted function application. Generate two
random numbers:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>a, b <span class="op">=</span> <span class="fu">randn</span>(Vec3d, <span class="fl">2</span>)</span></code></pre>
</div>
<p>Then time the subtraction broadcasted and non-broadcasted. Which is
faster? Why?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="pp">@btime</span> a <span class="op">-</span> b</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="pp">@btime</span> a <span class="op">.-</span> b</span></code></pre>
</div>
<p>Broadcasting is slower. It seems to do some needless allocation.
Clearly, the authors of <code>GeometryBasics</code> have taken effort to
optimize basic vector operations.</p>
</div>
</div>
</div>
</div>
<div id="callout6" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>We’re iterating over the range <code>1:(i-1)</code>, and so we don’t
compute forces twice. Momentum should be conserved!</p>
</div>
</div>
</div>
<p>Luckily the <code>drift!</code> function is much easier to implement,
and doesn’t require that we know about all particles.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">drift!</span>(p<span class="op">::</span><span class="dt">Particle</span>, dt)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    p.position <span class="op">+=</span> dt <span class="op">*</span> p.momentum <span class="op">/</span> p.mass</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="kw">function</span> <span class="fu">drift!</span>(particles, dt)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>        <span class="fu">drift!</span>(p, dt)</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>    <span class="cf">return</span> particles</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>Note that we defined the <code>drift!</code> function twice, for
different arguments. We’re using the dispatch mechanism to write
clean/readable code.</p>
<div class="section level3">
<h3 id="fixing-arguments">Fixing arguments<a class="anchor" aria-label="anchor" href="#fixing-arguments"></a></h3>
<p>One pattern that you can find repeatedly in the standard library is
that of <em>fixing</em> arguments of functions to make them more
composable. For instance, most comparison operators allow you to give a
single argument, saving the second argument for a second invocation.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">filter</span>(x <span class="op">-&gt;</span> x <span class="op">&lt;</span> <span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">&lt;</span>(<span class="fl">3</span>), <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)</span></code></pre>
</div>
<p>and even</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">map</span>(<span class="fu">filter</span>(<span class="fu">&lt;</span>(<span class="fl">5</span>)), <span class="fu">eachcol</span>(<span class="fu">rand</span>(<span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">5</span>)))</span></code></pre>
</div>
<p>We can do a similar thing here:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">kick!</span>(dt) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">Fix2</span>(kick!, dt)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">drift!</span>(dt) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">Fix2</span>(drift!, dt)</span></code></pre>
</div>
<p>These kinds of identities let us be flexible in how to use and
combine methods in different circumstances.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">leap_frog!</span>(dt) <span class="op">=</span> <span class="fu">drift!</span>(dt) <span class="op">∘</span> <span class="fu">kick!</span>(dt)</span></code></pre>
</div>
<p>This defines the <code>leap_frog!</code> function as first performing
a <code>kick!</code> and then a <code>drift!</code>. Another way to
compose these functions is the <code>|&gt;</code> operator. In contrast
to the <code>∘</code> operator, <code>|&gt;</code> is very popular and
seen everywhere in Julia code bases.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">leap_frog!</span>(particles, dt) <span class="op">=</span> particles <span class="op">|&gt;</span> <span class="fu">kick!</span>(dt) <span class="op">|&gt;</span> <span class="fu">drift!</span>(dt)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">leap_frog!</span>(dt) <span class="op">=</span> <span class="bu">Base</span>.<span class="fu">Fix2</span>(leap_frog!, dt)</span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="with-random-particles">With random particles<a class="anchor" aria-label="anchor" href="#with-random-particles"></a></h2>
<hr class="half-width"><p>Let’s run a simulation with some random particles</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">run_simulation</span>(particles, dt, n)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    result <span class="op">=</span> <span class="fu">Matrix</span><span class="dt">{typeof(Vec3d(1)u"m")}</span>(<span class="cn">undef</span>, n, <span class="fu">length</span>(particles))</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">deepcopy</span>(particles)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fu">eachrow</span>(result)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>        x <span class="op">=</span> <span class="fu">leap_frog!</span>(dt)(x)</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>        c[<span class="op">:</span>] <span class="op">=</span> [p.position for p <span class="kw">in</span> <span class="fu">values</span>(x)]</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>    <span class="fu">DataFrame</span>(<span class="op">:</span>time <span class="op">=&gt;</span> (<span class="fl">1</span><span class="op">:</span>n)dt, (<span class="fu">Symbol</span>.(<span class="st">"p"</span>, <span class="fu">keys</span>(particles)) <span class="op">.=&gt;</span> <span class="fu">eachcol</span>(result))<span class="op">...</span>)</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="frame-of-reference">Frame of reference<a class="anchor" aria-label="anchor" href="#frame-of-reference"></a></h3>
<p>We need to make sure that our entire system doesn’t have a net
velocity. Otherwise it will be hard to visualize our results!</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">set_still!</span>(particles)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    total_momentum <span class="op">=</span> <span class="fu">sum</span>(p.momentum <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles))</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    total_mass <span class="op">=</span> <span class="fu">sum</span>(p.mass <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles))</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>    correction <span class="op">=</span> total_momentum <span class="op">/</span> total_mass</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="fu">values</span>(particles)</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>        p.momentum <span class="op">-=</span> correction <span class="op">*</span> p.mass</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>    <span class="cf">return</span> particles</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="cf">end</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a></h3>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_orbits</span>(orbits<span class="op">::</span><span class="dt">DataFrame</span>)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], limits<span class="op">=</span>((<span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>), (<span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>), (<span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>)))</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>    <span class="cf">for</span> colname <span class="kw">in</span> <span class="fu">names</span>(orbits)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>        <span class="fu">scatter!</span>(ax, [orbits[<span class="fl">1</span>, colname] <span class="op">/</span> u<span class="st">"m"</span>])</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, orbits[!, colname] <span class="op">/</span> u<span class="st">"m"</span>)</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>    fig</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<p>Try a few times with two random particles. You may want to use the
<code>set_still!</code> function to negate any collective motion.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">random_orbits</span>(n, mass)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>    <span class="fu">random_particle</span>() <span class="op">=</span> <span class="fu">Particle</span>(mass, <span class="fu">randn</span>(Vec3d)u<span class="st">"m"</span>, <span class="fu">randn</span>(Vec3d)u<span class="st">"mm/s"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>    particles <span class="op">=</span> <span class="fu">set_still!</span>([<span class="fu">random_particle</span>() for _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n])</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    <span class="fu">run_simulation</span>(particles, <span class="fl">1.0</span>u<span class="st">"s"</span>, <span class="fl">5000</span>)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">random_orbits</span>(<span class="fl">3</span>, <span class="fl">1e6</span>u<span class="st">"kg"</span>) <span class="op">|&gt;</span> plot_orbits</span></code></pre>
</div>
<figure><img src="../fig/random-orbits.png" alt="the three-body problem" class="figure mx-auto d-block"><div class="figcaption">Possible random orbits for two and three
particles.</div>
</figure></div>
</section><section><h2 class="section-heading" id="solar-system">Solar System<a class="anchor" aria-label="anchor" href="#solar-system"></a></h2>
<hr class="half-width"><div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co">#| id: gravity</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="kw">const</span> SUN <span class="op">=</span> <span class="fu">Particle</span>(<span class="fl">2e30</span>u<span class="st">"kg"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">0.0</span>)u<span class="st">"m"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">0.0</span>)u<span class="st">"m/s"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="kw">const</span> EARTH <span class="op">=</span> <span class="fu">Particle</span>(<span class="fl">6e24</span>u<span class="st">"kg"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">1.5e11</span>, <span class="fl">0</span>, <span class="fl">0</span>)u<span class="st">"m"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>    <span class="fu">Vec3d</span>(<span class="fl">0</span>, <span class="fl">3e4</span>, <span class="fl">0</span>)u<span class="st">"m/s"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="kw">const</span> MOON <span class="op">=</span> <span class="fu">Particle</span>(<span class="fl">7.35e22</span>u<span class="st">"kg"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>    EARTH.position <span class="op">+</span> <span class="fu">Vec3d</span>(<span class="fl">3.844e8</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>)u<span class="st">"m"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>    <span class="fu">velocity</span>(EARTH) <span class="op">+</span> <span class="fu">Vec3d</span>(<span class="fl">0</span>, <span class="fl">1e3</span>, <span class="fl">0</span>)u<span class="st">"m/s"</span>)</span></code></pre>
</div>
<div id="challenge" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Plot the orbit of the moon around the earth. Make a
<code>Dataframe</code> that contains all model data, and work from
there. Can you figure out the period of the orbit?</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>
<code>Plots.jl</code> is in some ways the ‘standard’ plotting
package, but it is in fact quite horrible.</li>
<li>
<code>Makie.jl</code> offers a nice interface, pretty plots, is
generally stable and very efficient once things have been compiled.</li>
</ul></div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Testing and Plots </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co">#| file: src/Gravity.jl</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="kw">module</span> Gravity</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeometryBasics</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="op">&lt;&lt;</span>gravity<span class="op">&gt;&gt;</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="kw">end</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">JULIA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode julia" tabindex="0"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co">#| classes: ["task"]</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co">#| creates: episodes/fig/random-orbits.png</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="co">#| collect: figures</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="kw">module</span> Script</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="im">using</span> <span class="bu">GLMakie</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="im">using</span> <span class="bu">EfficientJulia.Gravity</span>: random_orbits</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_orbits!</span>(ax, orbits<span class="op">::</span><span class="dt">DataFrame</span>)</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>    <span class="cf">for</span> colname <span class="kw">in</span> <span class="fu">names</span>(orbits)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>        <span class="fu">scatter!</span>(ax, [orbits[<span class="fl">1</span>,colname] <span class="op">/</span> u<span class="st">"m"</span>])</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, orbits[!,colname] <span class="op">/</span> u<span class="st">"m"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="kw">function</span> <span class="fu">main</span>()</span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>    <span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">0</span>)</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a>    orbs1 <span class="op">=</span> <span class="fu">random_orbits</span>(<span class="fl">2</span>, <span class="fl">1e6</span>u<span class="st">"kg"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>    <span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">15</span>)</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a>    orbs2 <span class="op">=</span> <span class="fu">random_orbits</span>(<span class="fl">3</span>, <span class="fl">1e6</span>u<span class="st">"kg"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1024</span>, <span class="fl">600</span>))</span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>], azimuth<span class="op">=</span><span class="cn">π</span><span class="op">/</span><span class="fl">2</span><span class="op">+</span><span class="fl">0.1</span>, elevation<span class="op">=</span><span class="fl">0.1</span>π, title<span class="op">=</span><span class="st">"two particles"</span>)</span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>,<span class="fl">2</span>], azimuth<span class="op">=</span><span class="cn">π</span><span class="op">/</span><span class="fl">3</span>, title<span class="op">=</span><span class="st">"three particles"</span>)</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>    <span class="fu">plot_orbits!</span>(ax1, orbs1)</span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a>    <span class="fu">plot_orbits!</span>(ax2, orbs2)</span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a>    <span class="fu">save</span>(<span class="st">"episodes/fig/random-orbits.png"</span>, fig)</span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a>    fig</span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a>Script.<span class="fu">main</span>()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/040-dispatch-and-types.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/070-pkg.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/040-dispatch-and-types.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Types and Dispatch
        </a>
        <a class="chapter-link float-end" href="../instructor/070-pkg.html" rel="next">
          Next: Packages and...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/edit/main/episodes/060-simulating-solar-system.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/" class="external-link">Source</a></p>
				<p><a href="https://github.com/esciencecenter-digital-skills/efficient-computing-in-julia/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:j.hidding@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/instructor/060-simulating-solar-system.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, Julia, lesson",
  "name": "Simulating the Solar System",
  "creativeWorkStatus": "active",
  "url": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/instructor/060-simulating-solar-system.html",
  "identifier": "https://esciencecenter-digital-skills.github.io/efficient-computing-in-julia/instructor/060-simulating-solar-system.html",
  "dateCreated": "2024-01-01",
  "dateModified": "2025-01-14",
  "datePublished": "2025-01-14"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

